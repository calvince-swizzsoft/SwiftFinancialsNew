@using SwiftFinancials.Web.Identity


<style>
    .sidebar-collapse::-webkit-scrollbar {
        width: 8px;
    }

    .sidebar-collapse::-webkit-scrollbar-thumb {
        background-color: #1ab394;
        border-radius: 10px;
    }

</style>




<nav class="navbar-expand navbar-static-side" role="navigation">
    <div class="sidebar-collapse" style="height: 100vh; overflow-y: auto; background-color: #2f4050;">
        <ul class="nav metismenu" id="side-menu" style="padding: 15px;">
            <li class="nav-header" style="margin-bottom: 20px;">
                <div class="dropdown profile-element">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#" style="color: #fff;">
                        @if (Request.IsAuthenticated)
                        {
                            <span class="block m-t-xs font-bold">
                                <i class="fa fa-user-circle"></i>
                                @HttpContext.Current.User.Identity.GetFullName()
                            </span>
                        }
                        else
                        {
                            <span class="block m-t-xs font-bold">
                                @Html.Raw("Unknown user.")
                            </span>
                        }
                    </a>
                </div>
                <div class="logo-element" style="color: #fff; font-weight: bold;">
                    Menu
                </div>
            </li>
            <li class="@Html.IsSelected("Home")">
                <a href="@Url.Action("Index", "Home", new { Area = ""})" style="color: #a7b1c2;">
                    <i class="fa fa-home"></i>
                    <span class="nav-label">Dashboard</span>
                </a>
            </li>
            @{
                var menuList = ViewBag.NavigationItems as List<Application.MainBoundedContext.DTO.AdministrationModule.NavigationItemDTO>;

                if (menuList != null && menuList.Any())
                {
                    @RenderDynamicMenu(menuList)
                }
            }
        </ul>
    </div>
</nav>


@* Razor helper that recursively loops a <List> and renders a nested menu. *@
@helper RenderDynamicMenu(List<Application.MainBoundedContext.DTO.AdministrationModule.NavigationItemDTO> menusList, int? code = 0, int level = 0)
{
    var items = menusList.Where(m => m.AreaCode == code);

    if (items.Any())
    {
        //if areacode is greater than 0 it means the item is not one of the parent roots.
        if (items.First().AreaCode > 0)
        {
            level++;
        }
        foreach (var item in items)
        {

            var itemActionName = item.ActionName;

            var itemControllerName = item.ControllerName;

            var itemAreaName = item.AreaName;

            var itemDescription = item.Description;


            if (item.IsArea)
            {
                <li class="@Html.IsSelected(controller: itemControllerName ?? itemDescription)">
                    @*style the parent item differently since its not for navigation.*@
                    <a href="#"><i class="fa fa-th-large"></i> <span class="nav-label">@item.Description </span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse @Html.IsSelected(controller: itemControllerName ?? itemDescription, cssClass: "in")">
                        @RenderDynamicMenu(menusList, item.Code, level)
                    </ul>
                </li>
            }
            else
            {
                if (item.ControllerName == null && item.ActionName == null && !item.IsArea)
                {
                    <li class="@Html.IsSelected(controller: itemControllerName ?? itemDescription)">
                        @*style the sub-parent item differently since its not for navigation.*@
                        <a href="#"><i class="fa fa-sitemap"></i> <span class="nav-label">@item.Description</span><span class="fa arrow"></span></a>
                        <ul class="nav nav-third-level">
                            @RenderDynamicMenu(menusList, item.Code, level)
                        </ul>
                    </li>
                }
                else
                {
                    <li class="@Html.IsSelected(controller: itemControllerName)">
                        <a href="@Url.Action(itemActionName, itemControllerName, new { Area = itemAreaName})"><i class="@item.Icon"></i><span class="nav-label">@item.Description </span></a>
                    </li>

                    @RenderDynamicMenu(menusList, item.Code, level)
                }
            }
        }
    }
}