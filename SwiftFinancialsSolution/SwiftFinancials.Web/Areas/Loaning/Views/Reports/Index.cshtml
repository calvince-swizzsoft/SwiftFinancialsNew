@{
    ViewBag.Title = "Back Office Reports";
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-12">
        <h1>Back Office</h1>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                @Html.ActionLink("Dashboard", "Index", "Home", new { Area = "" }, null)
            </li>
            <li class="breadcrumb-item">
                @Html.ActionLink("Home", "Index", "LoanRegistration", new { Area = "Loaning" }, null)
            </li>
            <li class="breadcrumb-item active">
                <strong>Create</strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h2>Reports</h2>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content bg-white">
                    @using (Html.BeginForm("Index", "Reports", new { Area = "Loaning" }, FormMethod.Post))
                    {
                        <fieldset>
                            <label id="module">Report</label>
                            <select id="sub-module" width="200px;">
                                <option value="0">Registered Loans</option>
                                <option value="1">Appraised Loans</option>
                                <option value="2">Approved Loans</option>
                                <option value="3">Verified Loans</option>
                                <option value="4">Deferred Loans</option>
                                <option value="5">Rejected Loans</option>
                                <option value="6">Disbursed Loans</option>
                                <option value="7">Restructured Loans</option>
                            </select>

                            <input type="submit" class="btn btn-dark" value="Generate Report" style="width: 150px;" />

                            <!-- Registered Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="registeredLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Appraised Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="appraisedLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Approved Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="approvedLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Verified Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="verifiedLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Deferred Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="deferredLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Rejected Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="rejectedLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Disbursed Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="disbursedLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Restructured Loans -->
                            <div class="table-responsive loan-grid" style="overflow-x: auto;">
                                <table id="restructuredLoansGrid" class="table table-striped table-bordered table-hover" width="100%">
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="dataTables_empty">Loading data from server</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                        </fieldset>
                    }

                </div>
            </div>
        </div>
    </div>
</div>





@section Styles {
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
}

@section scripts {
    @Scripts.Render("~/plugins/dataTables")


    <script>
        $(document).ready(function () {
            function showGridBasedOnSelection() {
                var selectedValue = $('#sub-module').val();

                // Hide all grids
                $('.loan-grid').hide();

                // Show the selected grid
                switch (selectedValue) {
                    case '0':
                        $('#registeredLoansGrid').closest('.table-responsive').show();
                        break;
                    case '1':
                        $('#appraisedLoansGrid').closest('.table-responsive').show();
                        break;
                    case '2':
                        $('#approvedLoansGrid').closest('.table-responsive').show();
                        break;
                    case '3':
                        $('#verifiedLoansGrid').closest('.table-responsive').show();
                        break;
                    case '4':
                        $('#deferredLoansGrid').closest('.table-responsive').show();
                        break;
                    case '5':
                        $('#rejectedLoansGrid').closest('.table-responsive').show();
                        break;
                    case '6':
                        $('#disbursedLoansGrid').closest('.table-responsive').show();
                        break;
                    case '7':
                        $('#restructuredLoansGrid').closest('.table-responsive').show();
                        break;
                }
            }

            // Initial call to show the correct grid based on the default selection
            showGridBasedOnSelection();

            // Trigger the function when the dropdown value changes
            $('#sub-module').change(function () {
                showGridBasedOnSelection();
            });

            // Initialize DataTables (assuming the grids are loaded via AJAX when shown)
            $('#registeredLoansGrid, #appraisedLoansGrid, #approvedLoansGrid, #verifiedLoansGrid, #deferredLoansGrid, #rejectedLoansGrid, #disbursedLoansGrid, #restructuredLoansGrid').each(function () {
                var tableId = $(this).attr('id');
                $(this).DataTable({
                    // Your DataTable settings here...
                });
            });
        });
    </script>



    <script type="text/javascript">

        $(document).ready(function () {
            $('#LoanRegistrationsGrid').DataTable({
                // Ajax settings
                "sPaginationType": "full_numbers",
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": "@(Url.Action("Index", "AppraiseLoan", new { Area = "Loaning"}))",
                "sServerMethod": "POST",
                // Callback settings
                "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {

                   var createdDate = new Date(parseInt(aData.CreatedDate.replace("/Date(", "").replace(")/", ""), 10));
                    var h = ("0" + createdDate.getHours()).slice(-2);
                    var m = ("0" + createdDate.getMinutes()).slice(-2);
                    var s = ("0" + createdDate.getSeconds()).slice(-2);

                    var dt_Created = $.datepicker.formatDate('dd/mm/yy', createdDate) + " " + h + ":" + m + ":" + s;
                    aData.CreatedDate = dt_Created;

                    var receivedDate = new Date(parseInt(aData.ReceivedDate.replace("/Date(", "").replace(")/", ""), 10));
                    var h = ("0" + receivedDate.getHours()).slice(-2);
                    var m = ("0" + receivedDate.getMinutes()).slice(-2);
                    var s = ("0" + receivedDate.getSeconds()).slice(-2);

                    var dt_ReceivedDate = $.datepicker.formatDate('dd/mm/yy', receivedDate) ;
                    aData.ReceivedDate = dt_ReceivedDate;

                
                    //$('td:eq(4)', nRow).html(dt_ReceivedDate);
                    $('td:eq(9)', nRow).html(dt_Created);
                    return nRow;
                },
                // Display settings
                "aoColumns": [
                    { "mDataProp": "CaseNumber", "sTitle": "Loan Number", "sWidth": "5%" },
                    { "mDataProp": "CustomerFullName", "sTitle": "Customer", "sWidth": "10%" },
                    { "mDataProp": "GuarantorReference1", "sTitle": "Account Number", "sWidth": "10%" },
                    { "mDataProp": "GuarantorReference2", "sTitle": "Membership Number", "sWidth": "10%" },
                    { "mDataProp": "AmountApplied", "sTitle": "Amount Applied", "sWidth": "5%" },
                    { "mDataProp": "LoanProductDescription", "sTitle": "Loan Product", "sWidth": "7%" },
                    { "mDataProp": "LoanPurposeDescription", "sTitle": "Loan Purpose", "sWidth": "7%" },
                    { "mDataProp": "BranchDescription", "sTitle": "Branch", "sWidth": "7%" },
                    { "mDataProp": "SavingsProductDescription", "sTitle": "Savings Product", "sWidth": "7%" },
                    { "mDataProp": "CustomerStationZoneDivisionEmployerDescription", "sTitle": "Employer", "sWidth": "7%" },
                    { "mDataProp": "CustomerStation", "sTitle": "Station", "sWidth": "7%" },
                    { "mDataProp": "CreatedDate", "sTitle": "Created Date", "sWidth": "5%" }
                ],
            });
        });

        $(document).ajaxStart(function () {
            $('.ibox').children('.ibox-content').toggleClass('sk-loading');
        });
        $(document).ajaxStop(function () {
            $('.ibox').children('.ibox-content').toggleClass('sk-loading');
        });
    </script>
}
