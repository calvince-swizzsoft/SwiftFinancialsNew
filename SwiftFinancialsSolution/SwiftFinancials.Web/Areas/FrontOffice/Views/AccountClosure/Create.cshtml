﻿﻿@model  Application.MainBoundedContext.DTO.FrontOfficeModule.AccountClosureRequestDTO

@{
    /**/

    ViewBag.Title = "Create Account Closure";
    var customerTypes = ViewBag.AccountClosureSelectList as List<SelectListItem>;
    var ProductCode = ViewBag.CustomerAccountProductCodeSelectList as List<SelectListItem>;

    var customerFilter = ViewBag.CustomerFilterSelectList as List<SelectListItem>;


}

<head>
    <style>
        .tab-content > .tab-pane {
            display: none;
        }

            .tab-content > .tab-pane.active {
                display: block;
            }

        .secondary-tab-content > .secondary-tab-pane {
            display: none;
        }

            .secondary-tab-content > .secondary-tab-pane.active {
                display: block;
            }
    </style>
</head>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-12">
        <h2>Account Closure</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                @Html.ActionLink("Dashboard", "Index", "Home", new { Area = "" }, null)
            </li>
            <li class="breadcrumb-item">
                @Html.ActionLink("Home", "Index", "AccountClosure", new { Area = "FrontOffice" }, null)
            </li>
            <li class="breadcrumb-item active">
                <strong>Create</strong>
            </li>
        </ol>
    </div>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger fade in">
        <button class="close" data-dismiss="alert">
            ×
        </button>
        <i class="fa-fw fa fa-times"></i>
        <strong>Error!</strong> @TempData["Error"]
    </div>
}

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content bg-white text-info" style="border: 1px solid #ddd; border-radius: 4px; padding: 20px; margin-bottom: 20px;">
                    @using (Html.BeginForm("Create", "AccountClosure", new { Area = "FrontOffice" }, FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(model => model.BranchId)
                        @Html.HiddenFor(model => model.CustomerAccountId)
                        @Html.HiddenFor(model => model.CustomerAccountTypeTargetProductChartOfAccountId)
                        @Html.HiddenFor(model => model.CustomerAccountBranchId)
                        @Html.HiddenFor(model => model.CustomerAccountCustomerAccountTypeTargetProductId)

                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })


                        <div class="form-horizontal">

                            <!-- First Row -->
                            <div class="row">
                                <div class="col-md-3">
                                    <!-- Full Account Number with Lookup Modal -->
                                    <div class="form-group">

                                        @Html.LabelFor(model => model.CustomerAccountFullAccountNumber, "Full Account Number:", new { @class = "control-label" })
                                        <div class="input-group" data-autoclose="true">
                                            @Html.TextBoxFor(model => model.CustomerAccountCustomerIndividualLastName, new { @class = "form-control", @readonly = "", @id = "CustomerAccountCustomerIndividualLastName" }) <!-- Unique ID here -->
                                            <span class="input-group-addon">
                                                <a data-toggle="modal" data-target="#customerAccountLookupModal" onclick="captureDetails();">
                                                    <span class="fa fa-search"></span>
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountStatusDescription, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountTypeTargetProductChartOfAccountName, new { htmlAttributes = new { @class = "form-control", @placeholder = "", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountStatusDescription, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountRemarks, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountRemarks, new { htmlAttributes = new { @id = "CustomerAccountRemarks", @class = "form-control", @placeholder = "", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountRemarks, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountTypeTargetProductDescription, htmlAttributes: new { @class = "control-label" })
                                        @Html.HiddenFor(model => model.CustomerAccountTypeTargetProductChartOfAccountId)

                                        @Html.EditorFor(model => model.CustomerAccountTypeTargetProductDescription, new { htmlAttributes = new { @id = "CustomerAccountTypeTargetProductDescription", @class = "form-control", @placeholder = "", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountTypeTargetProductDescription, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>

                            <!-- Second Row -->
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerFullName, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerIndividualFirstName, new { htmlAttributes = new { @id = "CustomerAccountCustomerIndividualFirstName", @class = "form-control", @placeholder = "", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerFullName, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerTypeDescription, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerNonIndividualDescription, new { htmlAttributes = new { @class = "form-control datepicker", @placeholder = "", @id = "CustomerAccountCustomerTypeDescription", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerTypeDescription, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerIndividualPayrollNumbers, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerIndividualPayrollNumbers, new { htmlAttributes = new { @class = "form-control datepicker", @placeholder = "", @id = "CustomerAccountCustomerIndividualPayrollNumbers", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerIndividualPayrollNumbers, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>

                            <!-- Third Row -->
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerIdentificationNumber, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerIdentificationNumber, new { htmlAttributes = new { @class = "form-control datepicker", @placeholder = "", @id = "CustomerAccountCustomerIdentificationNumber", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerIdentificationNumber, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerReference1, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerReference1, new { htmlAttributes = new { @class = "form-control datepicker", @placeholder = "", @id = "CustomerAccountCustomerReference1", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerReference1, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerReference2, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerReference2, new { htmlAttributes = new { @class = "form-control datepicker", @placeholder = "", @id = "CustomerAccountCustomerReference2", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerReference2, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerReference3, htmlAttributes: new { @class = "control-label" })
                                        @Html.EditorFor(model => model.CustomerAccountCustomerReference3, new { htmlAttributes = new { @class = "form-control datepicker", @placeholder = "", @id = "CustomerAccountCustomerReference3", @readonly = "" } })
                                        @Html.ValidationMessageFor(model => model.CustomerAccountCustomerReference3, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="col-lg-12">
                                    <div class="form-group form-group-lg">
                                        @Html.LabelFor(model => model.Reason, htmlAttributes: new { @class = "control-label" })
                                        @Html.TextAreaFor(model => model.Reason, new { @rows = 3, @class = "form-control", @placeholder = "Enter Text.....", @required = "" })
                                    </div>
                                </div>
                            </div>

                            <br />
                            <hr />





                            <ul class="nav nav-tabs" id="loanAccountsTab">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#loanAccounts" data-toggle="tab">Loan Accounts</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#investmentAccounts" data-toggle="tab">Investment Accounts</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#loansGuaranteed" data-toggle="tab">Loans Guaranteed</a>
                                </li>
                            </ul>

                            <div class="tab-content">
                                <!-- Loan Accounts Tab Content -->
                                <div id="loanAccounts" class="tab-pane fade show active">
                                    <h3>Customer Loan Accounts</h3>

                                    @if (ViewBag.LoanAccounts != null && ViewBag.LoanAccounts.Count > 0)
                                    {
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Full Account Number</th>
                                                    <th>Status</th>
                                                    <th>Remarks</th>
                                                    <th>Product Code</th>
                                                    <th>Product Name</th>
                                                    <th>Section</th>
                                                    <th>Branch</th>
                                                    <th>Book Balance</th>
                                                    <th>Principal Balance</th>
                                                    <th>Interest Balance</th>
                                                    <th>Record Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var levySplit in ViewBag.LoanAccounts)
                                                {
                                                    <tr>
                                                        <td>@levySplit.FullAccountNumber</td>
                                                        <td>@levySplit.StatusDescription</td>
                                                        <td>@levySplit.Remarks</td>
                                                        <td>@levySplit.CustomerAccountTypeTargetProductCode</td>
                                                        <td>@levySplit.CustomerAccountTypeTargetProductDescription</td>
                                                        <td>@levySplit.CustomerAccountTypeTargetProductLoanProductSectionDescription</td>
                                                        <td>@levySplit.BranchDescription</td>
                                                        <td>@levySplit.BookBalance</td>
                                                        <td>@levySplit.PrincipalBalance</td>
                                                        <td>@levySplit.InterestBalance</td>
                                                        <td>@levySplit.RecordStatus</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    }
                                    else
                                    {
                                        <p>No loan accounts found for this customer.</p>
                                    }
                                </div>

                                <!-- Investment Accounts Tab Content -->
                                <div id="investmentAccounts" class="tab-pane fade">
                                    <h3>Customer Investment Accounts</h3>

                                    @if (ViewBag.InvestmentAccounts != null && ViewBag.InvestmentAccounts.Count > 0)
                                    {
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Parent Chart of Account Name</th>
                                                    <th>Description</th>
                                                    <th>Minimum Balance</th>
                                                    <th>Maximum Balance</th>
                                                    <th>Pool Amount</th>
                                                    <th>Annual Percentage Yield</th>
                                                    <th>Transfer Balance on Termination</th>
                                                    <th>Account Name</th>
                                                    <th>Chart of Account Name</th>
                                                    <th>Cost Center</th>
                                                    <th>Product Name</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var investmentAccount in ViewBag.InvestmentAccounts)
                                                {
                                                    <tr>
                                                        <td>@investmentAccount.ParentChartOfAccountNameDescription</td>
                                                        <td>@investmentAccount.Description</td>
                                                        <td>@investmentAccount.MinimumBalance</td>
                                                        <td>@investmentAccount.MaximumBalance</td>
                                                        <td>@investmentAccount.PoolAmount</td>
                                                        <td>@investmentAccount.AnnualPercentageYield</td>
                                                        <td>@investmentAccount.TransferBalanceToParentOnMembershipTermination</td>
                                                        <td>@investmentAccount.ChartOfAccountAccountName</td>
                                                        <td>@investmentAccount.ChartOfAccountName</td>
                                                        <td>@investmentAccount.ChartOfAccountCostCenterDescription</td>
                                                        <td>@investmentAccount.ProductName</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    }
                                    else
                                    {
                                        <p>No investment accounts found for this customer.</p>
                                    }
                                </div>


                                <!-- Loans Guaranteed Tab Content -->
                                <div id="loansGuaranteed" class="tab-pane fade">
                                    <h3>Loans Guaranteed</h3>
                                    <!-- Add your content for loans guaranteed here -->

                                    @if (ViewBag.LoanGuarantors != null && ViewBag.LoanGuarantors.Count > 0)
                                    {
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                   
                                                    <th>Loanee Customer FullName</th>
                                                    <th>LoanProduct Description</th>
                                                    <th>LoanCaseStatus Description</th>
                                                    <th>CustomerType Description</th>
                                                    <th>CustomerAddress MobileLine</th>
                                                    <th>AmountGuaranteed</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var guarantor in ViewBag.LoanGuarantors)
                                                {
                                                    <tr>
                                                        
                                                        <td>@guarantor.LoaneeCustomerFullName</td>
                                                        <td>@guarantor.LoanProductDescription</td>
                                                        <td>@guarantor.LoanCaseStatusDescription</td>
                                                        <td>@guarantor.CustomerTypeDescription</td>
                                                        <td>@guarantor.CustomerAddressMobileLine</td>
                                                        <td>@guarantor.AmountGuaranteed</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    }
                                    else
                                    {
                                        <p>No loan guarantors found for this customer.</p>
                                    }
                                </div>






                            </div>


                            <br />
                            <hr />


                            <div class="summary-section">
                                <h3>Account Closure Summary</h3>
                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            @Html.Label("Investments Balance (R)", htmlAttributes: new { @class = "control-label" })
                                            <input type="text" class="form-control" readonly value="@Model.InvestmentBalance.ToString("C2")" />
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            @Html.Label("Loans Balance (R)", htmlAttributes: new { @class = "control-label" })
                                            <input type="text" class="form-control" readonly value="@Model.LoanBalance.ToString("C2")" />
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            @Html.Label("Net Refundable (R)", htmlAttributes: new { @class = "control-label" })
                                            <input type="text" class="form-control" readonly value="@Model.NetRefundable.ToString("C2")" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="ibox-content bg-white text-info">
                                <div class="col-lg-3" style="float: right;">
                                    <input type="submit" style="width: 100px;" value="Create" class="btn btn-primary" />
                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal  fade" id="customerAccountLookupModal" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header  bg-primary">
                <h3 class="font-bold">Customers Account Lookup<button type="button" class="close" data-dismiss="modal"><span class="sr-only">Close</span></button></h3>
            </div>
            <div class="modal-body">
                <!-- Table for Account Closure Requests -->
                <div class="table-responsive" style="overflow-x: auto;">
                    <table id="CustomerAccountsGrid" class="table table-striped table-bordered table-hover" style="min-width: 1000px;">
                        <tbody>
                            <tr>
                                <td class="dataTables_empty">Loading data from server</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Filter Form -->
                <div class="blue-section mt-1">
                    <form id="CustomerModalFilterForm">
                        <div class="row align-items-end mb-3">
                            <div class="col-md-3">
                                <div id="items-dropdown"></div>
                            </div>
                            <div class="col-md-9">
                                <div id="page-control"></div>
                            </div>
                        </div>

                        @*<div class="row align-items-end mb-3">

                            </div>*@

                    <div class="row align-items-end">

                        <div class="col-md-2">
                            <div class="form-group mb-0">
                                <label for="CustomerProductCodeCustomerFilter">Product Code</label>
                                @Html.DropDownListFor(m => m.CustomerProductCodeCustomerFilter, ProductCode, new { @class = "form-control", @id = "CustomerProductCodeCustomerFilter" })
                            </div>
                        </div>


                        <div class="col-md-2">
                            <div class="form-group mb-0">

                                <div class="input-group">

                                    @Html.DropDownListFor(m => m.CustomerAccountCustomerFilter, customerFilter,
                                    new { @class = "form-control", @id = "CustomerAccountCustomerFilter" })
                                </div>
                            </div>
                        </div>




                        <div class="col-md-6">
                            <div id="searchField" class="form-group mb-0"></div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group mb-0">
                                <button type="submit" id="refreshButton" class="btn btn-success form-control">Refresh</button>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>

                <style>
                    .blue-section {
                        background-color: #e6f3ff;
                        padding: 15px;
                        border-radius: 5px;
                    }

                    .row.align-items-end {
                        display: flex;
                        align-items: flex-end;
                    }

                        .row.align-items-end > div {
                            display: flex;
                            flex-direction: column;
                        }

                    #searchField {
                        width: 100%;
                    }

                        #searchField .dataTables_filter {
                            margin-bottom: 0;
                            width: 100%;
                        }

                            #searchField .dataTables_filter label {
                                width: 100%;
                                margin-bottom: 0;
                                display: flex;
                            }

                            #searchField .dataTables_filter input {
                                width: 100% !important;
                                margin-left: 0 !important;
                                height: calc(1.5em + .75rem + 2px); /* Match Bootstrap's form-control height */
                            }

                    #items-dropdown .dataTables_length {
                        margin-bottom: 0;
                    }

                    #page-control .dataTables_paginate {
                        float: right;
                    }
                </style>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>
<input type="hidden" id="customerId" name="customerId" />


@section Styles{
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/plugins/wizardStepsStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/plugins/dateRangeStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/plugins/tagInputsStyles")
    @Styles.Render("~/plugins/duallistStyles")
}

@section Scripts{
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/validate")
    @Scripts.Render("~/plugins/typehead")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/tagInputs")
    @Scripts.Render("~/plugins/duallist")









    <script>
    // Set Default Value for Filters
    var defaultProductCode = $('#CustomerProductCodeCustomerFilter').val();

    // Refresh button for reloading the DataTable after applying the filters
    $('#CustomerModalFilterForm').on('submit', function (e) {
        e.preventDefault();
        $('#CustomerAccountsGrid').DataTable().ajax.reload();
    });

    // Initialize the DataTable
    var customerTable = $('#CustomerAccountsGrid').DataTable({
        "sPaginationType": "full_numbers",
        "bProcessing": true,
        "bServerSide": true,
        "sAjaxSource": "@(Url.Action("Index", "CustomerAccounts", new { Area = "Accounts" }))",
        "sServerMethod": "POST",
        "fnServerParams": function (aoData) {
            aoData.push(
                { "name": "productCode", "value": $('#CustomerProductCodeCustomerFilter').val() || defaultProductCode },
            );
        },


        "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
            var createdDate = new Date(parseInt(aData.CreatedDate.replace("/Date(", "").replace(")/", ""), 10));
            var h = ("0" + createdDate.getHours()).slice(-2);
            var m = ("0" + createdDate.getMinutes()).slice(-2);
            var s = ("0" + createdDate.getSeconds()).slice(-2);

            var dt_Created = $.datepicker.formatDate('dd/mm/yy', createdDate) + " " + h + ":" + m + ":" + s;
            aData.CreatedDate = dt_Created;

            // Change URL to point to Edit action
            var selectUrl = '<a href="/FrontOffice/AccountClosure/Create/' + aData.Id + '" class="btn btn-outline-info">Select</a>';

            // Update the table row with formatted date and select button
            $('td:eq(5)', nRow).html(dt_Created);
            $('td:eq(6)', nRow).html(selectUrl);

            return nRow;
        },

        "aoColumns": [
            { "mDataProp": "RecordStatusDescription", "sTitle": "Record Status", "sWidth": "15%" },
            { "mDataProp": "BranchDescription", "sTitle": "Branch Name", "sWidth": "15%" },
            { "mDataProp": "CustomerAccountTypeProductCodeDescription", "sTitle": "Product Name", "sWidth": "15%" },
            { "mDataProp": "CustomerFullName", "sTitle": "Customer Full Name", "sWidth": "15%" },
            { "mDataProp": "CustomerTypeDescription", "sTitle": "Customer Type", "sWidth": "15%" },
            { "mDataProp": "CreatedDate", "sTitle": "Created Date", "sWidth": "15%" },
            { "mDataProp": "CreatedDate", "sTitle": "", "sWidth": "15%", "bSortable": false }
        ],
        "aaSorting": [[0, "desc"]],
        "dom": 'lftip',
        "responsive": true,
        "initComplete": function (settings, json) {
            $('#CustomerAccountsGrid_length').appendTo('.blue-section .row:first-child #items-dropdown');
            $('#CustomerAccountsGrid_filter').appendTo('.blue-section #searchField').find('input').attr('placeholder', 'Search...');
            $('#CustomerAccountsGrid_filter label').contents().filter(function () {
                return this.nodeType === 3;
            }).remove();
            $('#Customers_paginate').appendTo('.blue-section .row:first-child #page-control');
        },
        "error": function (xhr, error, thrown) {
            console.log("Error fetching data: ", xhr, error, thrown);
            alert("Failed to load data. Please try again.");
        }
    });

    // Customer selection logic with status check
    $("#CustomerAccountsGrid tbody").on("click", "tr", function () {
        var data = customerTable.row(this).data();  // Use the correct DataTable instance

        // Check if the customer's status is 'Approved'
        if (data.RecordStatusDescription !== 'Approved') {
            // Alert the user that they need to select an approved customer
            alert('Please select a customer with an Normal status.');
        } else {
            // Populate Edit form fields based on selected customer account details
            $('#Id').val(data.Id);
            $('#CustomerAccountCustomerId').val(data.CustomerAccountCustomerId);
            $('input[name=CustomerAccountFullAccountNumber]').val(data.FullAccountNumber);
            $('#CustomerStationZoneDivisionEmployerDescription').val(data.StationDescription);
            $('#CustomerAccountCustomerIndividualLastName').val(data.FullAccountNumber);
            $('#CustomerAccountTypeTargetProductChartOfAccountName').val(data.StationDescription);
            $('#CustomerReference1').val(data.CustomerReference1);
            $('#CustomerReference2').val(data.CustomerReference2);
            $('#CustomerAccountCustomerIndividualFirstName').val(data.CustomerFullName);
            $('#CustomerAccountCustomerIndividualIdentityCardNumber').val(data.IndividualIdentityCardNumber);
            $('#CustomerAccountCustomerIndividualPayrollNumbers').val(data.IndividualPayrollNumbers);
            $('#CustomerAccountTypeTargetProductDescription').val(data.CustomerAccountTypeTargetProductDescription);
            $('#CustomerAccountTypeProductCodeDescription').val(data.CustomerAccountTypeProductCodeDescription);

            // Close the modal
            $('#customerLookupModal').modal('hide');
        }
    });
    </script>


    //ajax form submisstion
    <script>
       $(document).ready(function () {
    $('#form').submit(function (e) {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "AccountClosure")',
            data: $(this).serialize(),
            success: function (response) {
                if (response.success) {
                    // Redirect to the Index page of the ExpensePayable controller
                    window.location.href = '@Url.Action("Index", "AccountClosure")';
                } else {
                    alert(response.message);
                }
            },
            error: function () {
                alert("An error occurred while processing your request.");
            }
        });
    });

    </script>

    <script>
        $(document).ready(function () {
            // Update Loan Accounts Tab Content
            $('input, textarea').on('input', function () {
                // Fetch values from form fields
                var accountNumber = $('#CustomerAccountRemarks').val();
                var accountStatus = $('#CustomerAccountStatusDescription').val();
                var productName = $('#CustomerAccountTypeTargetProductDescription').val();
                var customerName = $('#CustomerAccountCustomerFullName').val();
                var customerIdentification = $('#CustomerAccountCustomerIdentificationNumber').val();

                // Update the Loan Accounts Tab content
                $('#loanAccountNumber').text(accountNumber);
                $('#loanAccountStatus').text(accountStatus);
                $('#loanProductName').text(productName);
                $('#loanCustomerName').text(customerName);
                $('#loanCustomerIdentification').text(customerIdentification);
            });



        });

    </script>

    <script>
        $(document).ready(function () {
            $('#loanAccountsTab a').on('click', function (e) {
                e.preventDefault();

                $('.nav-link').removeClass('active');
                $('.tab-pane').removeClass('show active');

                $(this).addClass('active');

                var target = $(this).attr('href');

                $(target).addClass('show active');

                console.log('Tab clicked:', target);
            });
        });




    </script>


}