@model Application.MainBoundedContext.DTO.FrontOfficeModule.InHouseChequeDTO

@{
    ViewBag.Title = "Cheque Writing";



}







<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    $(document).ready(function () {
        // Initially activate the first tab
        $('.nav-tabs li:first-child a').addClass('active');
        $('#tab1').addClass('active');

        // Handle tab click event
        $('.tab-link').on('click', function (e) {
            e.preventDefault();

            // Deactivate all tabs
            $('.tab-link').removeClass('active');
            $('.tab-content').removeClass('active');

            // Activate the clicked tab
            $(this).addClass('active');
            $($(this).attr('href')).addClass('active');
        });

        // Datepicker Initialization
        $('#ValueDate').datepicker({
            format: 'dd/mm/yyyy',
            todayHighlight: true,
            autoclose: true
        });
    });
</script>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-12">
        <h1>Cheque Writing</h1>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                @Html.ActionLink("Dashboard", "Index", "Home", new { Area = "" }, null)
            </li>
            <li class="breadcrumb-item">
                @Html.ActionLink("Home", "Index", "InHouse", new { Area = "FrontOffice" }, null)
            </li>
            <li class="breadcrumb-item active">
                <strong>Create</strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">

                    <div>
                        @if (ViewBag.SuccessMessage != null)
                        {
                    <div id="successMessage" class="alert alert-success">
                        @ViewBag.SuccessMessage
                    </div>
                                    <script>
                                        $(document).ready(function () {
                                            // Show a confirmation dialog
                                            var wantToPrint = confirm("Do you want to print the cheque?");
                                            if (wantToPrint) {
                                                // Call the print function
                                                printCheque();
                                            }
                                        });

                                        function printCheque() {
                                            var printContents = document.getElementById("chequeDetails").innerHTML;
                                            var originalContents = document.body.innerHTML;

                                            document.body.innerHTML = printContents;
                                            window.print();
                                            document.body.innerHTML = originalContents; // Restore original content
                                        }

                                    </script>}

                        @if (ViewBag.ChequePrintData != null)
                        {
                            var cheque = ViewBag.ChequePrintData;
                    <div id="chequeDetails">
                        <h3>Cheque Details</h3>
                        <p><strong>Payee:</strong> @cheque.Payee</p>
                        <p><strong>Amount:</strong> @cheque.Amount</p>
                        <p><strong>Date:</strong> @cheque.CreatedDate.ToShortDateString()</p>
                        <p><strong>Cheque Number:</strong> @cheque.ChequeNumber</p>
                        <p><strong>Reference:</strong> @cheque.Reference</p>
                        <p><strong>Wordified Amount:</strong> @cheque.WordifiedAmount</p>
                        <p><strong>Padded Amount:</strong> @cheque.PaddedAmount</p>
                        <p><strong>Bank Name:</strong> @cheque.BankName</p>
                        <p><strong>Bank Branch:</strong> @cheque.BranchDescription</p>
                        <p><sctrong>Bank Account:</sctrong> @cheque.BankAccount</p>
                        <p><strong>Debit G/L Account Name</strong> @cheque.DebitChartOfAccountAccountName</p>

                        <!-- Add other relevant cheque details here -->
                    </div>}
                    </div>

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger">
                            @TempData["ErrorMessage"]
                        </div>}


                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        @using (Html.BeginForm("Create", "InHouse", new { Area = "FrontOffice" }, FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()

                            @Html.HiddenFor(model => model.DebitCustomerAccountCustomerAccountTypeProductCode)
                            @Html.HiddenFor(model => model.DebitCustomerAccountCustomerAccountTypeTargetProductId)
                            @Html.HiddenFor(model => model.BranchId)
                            @Html.HiddenFor(model => model.BranchDescription)




                            <!-- Expense Payables -->
                            <fieldset>
                                <div class="card mb-4">
                                    <div class="card-body text-info">
                                        <div class="row">
                                            <!-- Select Field -->
                                            <div class="col-lg-4">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.FundingDescription, new { @class = "control-label" })
                                                    <div class="input-group">
                                                        <span class="input-group-addon">
                                                            <i class="fa fa-bars fa-fw"></i>
                                                        </span>
                                                        @Html.DropDownListFor(model => model.FundingDescription,
                                                            new SelectList(new List<SelectListItem>
                                                            {
                                                                new SelectListItem { Text = "Debit G/L Account", Value = "Debit G/L Account" },
                                                                new SelectListItem { Text = "Debit Customer Account", Value = "Debit Customer Account" }
                                                            }, "Value", "Text"),
                                                            new { @class = "form-control", @id = "FundingDescription" }
                                                        )
                                                        @Html.ValidationMessageFor(model => model.FundingDescription)
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- G/L Account Fields -->
                                            <div class="col-lg-4 gl-fields">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.DebitChartOfAccountAccountName, new { @class = "control-label" })
                                                    @Html.HiddenFor(model => model.DebitChartOfAccountId, new { id = "DebitChartOfAccountId" })
                                                    <div class="input-group">
                                                        @Html.EditorFor(model => model.DebitChartOfAccountAccountName, new { htmlAttributes = new { @class = "ChartOfAccountsLookup form-control required", placeholder = "Enter space to autofill...", id = "DebitChartOfAccountAccountName" } })
                                                        <span class="input-group-addon">
                                                            <a data-toggle="modal" data-target="#glAccountLookup">
                                                                <span class="fa fa-search"></span>
                                                            </a>
                                                        </span>
                                                    </div>
                                                    @Html.ValidationMessageFor(model => model.DebitChartOfAccountAccountName, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <div class="col-lg-4 gl-fields">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.CostCenter, new { @class = "control-label" })
                                                    @Html.HiddenFor(model => model.CostCenterId, new { id = "CostCenterId" })
                                                    @Html.EditorFor(model => model.CostCenter, new { htmlAttributes = new { @class = "form-control", placeholder = "Cost Center" } })
                                                    @Html.ValidationMessageFor(model => model.CostCenter, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <!-- Customer Account Fields -->
                                            <div class="col-lg-4 customer-fields">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.DebitCustomerAccountFullAccountNumber, new { @class = "control-label" })
                                                    @Html.HiddenFor(model => model.DebitCustomerAccountId, new { id = "DebitCustomerAccountId" })
                                                    <div class="input-group">
                                                        @Html.EditorFor(model => model.DebitCustomerAccountFullAccountNumber, new { htmlAttributes = new { @class = "form-control required", placeholder = "Enter space to autofill...", id = "DebitCustomerAccountFullAccountNumber" } })
                                                        <span class="input-group-addon">
                                                            <a data-toggle="modal" data-target="#customerAccountLookup">
                                                                <span class="fa fa-search"></span>
                                                            </a>
                                                        </span>
                                                    </div>
                                                    @Html.ValidationMessageFor(model => model.DebitCustomerAccountFullAccountNumber, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <!-- Available Balance -->
                                            <div class="col-lg-4 customer-fields">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.AvailableBalance, new { @class = "control-label" })
                                                    @Html.EditorFor(model => model.AvailableBalance, new { htmlAttributes = new { @class = "form-control required", placeholder = "Available Balance", id = "AvailableBalance" } })
                                                    @Html.ValidationMessageFor(model => model.AvailableBalance, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.ChequeTypeDescription, "Cheque Type", new { @class = "control-label" })
                                                    @Html.HiddenFor(model => model.ChequeTypeId, new { id = "ChequeTypeId" })
                                                    <div class="input-group" data-autoclose="true">
                                                        @Html.EditorFor(model => model.ChequeTypeDescription, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Text...", id = "ChequeTypeDescription" } })
                                                        <span class="input-group-addon">
                                                            <a data-toggle="modal" data-target="#ChequeTypeLookupModal">
                                                                <span class="fa fa-search"></span>
                                                            </a>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.Amount, new { @class = "control-label" })
                                                    @Html.EditorFor(model => model.Amount, new { htmlAttributes = new { @class = "form-control", placeholder = "Enter amount...", id = "Amount" } })
                                                    @Html.ValidationMessageFor(model => model.Amount, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.Payee, new { @class = "control-label" })
                                                    @Html.EditorFor(model => model.Payee, new { htmlAttributes = new { @id = "Payee", @class = "form-control", @placeholder = "Enter payee..." } })
                                                    @Html.ValidationMessageFor(model => model.Payee, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="form-group form-group-lg">
                                                    @Html.LabelFor(model => model.Reference, new { @class = "control-label" })
                                                    @Html.TextAreaFor(model => model.Reference, new { @rows = 3, @class = "form-control", @placeholder = "Enter reference..." })
                                                    @Html.ValidationMessageFor(model => model.Reference, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <br />

                                        <div class="row d-flex justify-content-end">
                                            <div class="form-group form-group-lg">
                                                <div class="custom-control custom-checkbox">
                                                    @Html.CheckBoxFor(model => model.Chargeable, new { @class = "custom-control-input", id = "applyCharges" })
                                                    <label class="custom-control-label" for="applyCharges">Chargeable?</label>
                                                </div>
                                            </div>
                                            <div class="col-lg-3">
                                                <div class="form-group form-group-sm">
                                                    <button id="addEntryButton" class="btn btn-primary">Add</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Table for showing added entries -->
                                        <table id="ExpensePayableEntries" class="table table-bordered" style="margin-top: 20px;">
                                            <thead>
                                                <tr>
                                                    <td><input type="checkbox" class="entry-checkbox" /></td>
                                                    <th>Branch Name</th>
                                                    <th>Cheque Type</th>
                                                    <th>Funding</th>
                                                    <th>GL Account Name</th>
                                                    <th>Customer Account Number</th>
                                                    <th>Payee</th>
                                                    <th>Amount</th>
                                                    <th>Wordified Amount</th>
                                                    <th>Padded Amount</th>
                                                    <th>Reference</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Dynamic rows will be appended here -->
                                            </tbody>
                                        </table>


                                        <!-- Popup container -->
                                        <div id="popupMessage" class="alert alert-success" style="display: none; position: fixed; top: 20px; right: 20px; padding: 10px; border-radius: 5px;">
                                            Entry added successfully!
                                        </div>

                                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                                    </div>
                                    <div class="form-group">
                                        <button id="removeTransaction" type="button" class="btn btn-danger btn-remove" disabled>Remove</button>
                                    </div>
                                </div>
                            </fieldset>
                            <div class="form-group">

                                <input type="submit" value="Update" class="btn btn-primary btn-update" />
                                <a href="@Url.Action("Index", "InHouseCheque")" class="btn btn-secondary">Cancel</a>
                            </div>



                        }
                    </div>
                </div>


                <style>
                    .card {
                        margin-bottom: 20px;
                    }

                    .nav-tabs .nav-link.active {
                        background-color: #007bff;
                        color: white;
                    }

                    .form-group-lg {
                        margin-bottom: 1.5rem;
                    }

                    .form-control {
                        border-radius: .25rem;
                    }
                </style>



            </div>
        </div>
    </div>
</div>

 G/L Account Lookup Modal
<div class="modal fade" id="glAccountLookup" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h3 class="font-bold">
                    G/L Account Lookup
                    <button type="button" class="close" data-dismiss="modal"><span class="sr-only">Close</span></button>
                </h3>
            </div>
            <div class="modal-body">
                <table id="glAccountDetailsTable" class="table table-striped table-bordered table-hover" style="width:100%;">
                    <thead>
                        <tr>
                            <th>Parent Account Name</th>
                            <th>Cost Center</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="dataTables_empty">Loading data from server</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="customerAccountLookup" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h3 class="font-bold">
                    Customers Account Lookup
                    <button type="button" class="close" data-dismiss="modal"><span class="sr-only">Close</span></button>
                </h3>
            </div>
            <div class="modal-body">
                <table id="CustomerAccountsGrid" class="table table-striped table-bordered table-hover" style="width:100%;">
                    <thead>
                        <tr>
                            <th>Record Status</th>
                            <th>Branch Name</th>
                            <th>Status</th>
                            <th>Customer Full Name</th>
                            <th>Customer Type</th>
                            <th>Created Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="dataTables_empty">Loading data from server</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>




<!-- Modal for Cheque Type Lookup -->
<div class="modal fade" id="ChequeTypeLookupModal" tabindex="-1" role="dialog" aria-labelledby="ChequeTypeLookupModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ChequeTypeLookupModalLabel">Cheque Type Lookup</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table id="ChequeTypeGrid" class="table table-striped table-bordered" style="width:100%;">
                    <thead>
                        <tr>
                            <th>Cheque Type</th>
                            <th>Created Date</th>
                            <th>Select</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="dataTables_empty">Loading data from server</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>









@section Styles{
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/plugins/wizardStepsStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/plugins/dateRangeStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/plugins/tagInputsStyles")
    @Styles.Render("~/plugins/duallistStyles")
    @Styles.Render("~/Content/plugins/jqueryValidationStyles")
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
}

@section Scripts{
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/validate")
    @Scripts.Render("~/plugins/typehead")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/tagInputs")
    @Scripts.Render("~/plugins/duallist")
    @Scripts.Render("~/plugins/jquery")
    @Scripts.Render("~/plugins/jqueryValidate")
    @Scripts.Render("~/plugins/jqueryValidateUnobtrusive")


    <script>
        $(document).ready(function () {
            // Hide the fields initially
            $('.gl-fields').hide();
            $('.customer-fields').hide();

            // Function to toggle fields
            $('#FundingDescription').change(function () {
                var selectedOption = $(this).val();

                if (selectedOption === 'Debit G/L Account') {
                    $('.gl-fields').show();  // Show G/L Account fields
                    $('.customer-fields').hide();  // Hide Customer Account fields
                } else if (selectedOption === 'Debit Customer Account') {
                    $('.customer-fields').show();  // Show Customer Account fields
                    $('.gl-fields').hide();  // Hide G/L Account fields
                } else {
                    // Hide all fields if no valid option is selected
                    $('.gl-fields').hide();
                    $('.customer-fields').hide();
                }
            });

            // Trigger change event on page load to set the initial state
            $('#FundingDescription').trigger('change');
        });

    </script>


    <script>
$(document).ready(function () {
    $('#glAccountDetailsTable').DataTable({
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "@Url.Action("GetGLAccounts", "InHouse", new { Area = "FrontOffice" })",
            "type": "GET",
            "dataSrc": function (json) {
                if (json.error) {
                    alert(json.error);
                    return [];
                }
                return json.data;
            }
        },
        "columns": [
            { "data": "ParentAccountName", "title": "Parent Account Name", "width": "70%" },
            { "data": "CostCenterDescription", "title": "Cost Center", "width": "30%" },
            {
                "data": null,
                "defaultContent": '<a href="#" class="btn btn-outline-info select-gl-account">Select</a>',
                "orderable": false
            }
        ],
        "order": [[0, "asc"]]
    });

    // Handle the click event for the Select button
    $('#glAccountDetailsTable tbody').on('click', '.select-gl-account', function () {
        var table = $('#glAccountDetailsTable').DataTable();
        var data = table.row($(this).parents('tr')).data(); // Get the selected row data

        // Populate the form fields with the selected data
        $('#DebitChartOfAccountAccountName').val(data.AccountName);
        $('#CostCenter').val(data.CostCenterDescription);
        $('#CostCenterId').val(data.CostCenterId);
        $('#DebitChartOfAccountId').val(data.Id);


        // Close the modal
        $('#glAccountLookup').modal('hide');
    });
});
    </script>


    <script>
    $(document).ready(function () {
        // Initialize DataTable for Customer Accounts
        $('#CustomerAccountsGrid').DataTable({
            "sPaginationType": "full_numbers",
            "bProcessing": true,
            "bServerSide": true,
            "sAjaxSource": "@Url.Action("Index", "CustomerAccounts", new { Area = "Accounts" })",
            "sServerMethod": "POST",
            "fnServerData": function (sSource, aoData, fnCallback) {
                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: sSource,
                    data: aoData,
                    success: function (response) {
                        fnCallback(response);
                    },
                    error: function () {
                        alert('Error retrieving data from the server.');
                    }
                });
            },
            "aoColumns": [
                { "mDataProp": "RecordStatusDescription", "sTitle": "Record Status", "sWidth": "15%" },
                { "mDataProp": "BranchDescription", "sTitle": "Branch Name", "sWidth": "15%" },
                { "mDataProp": "StatusDescription", "sTitle": "Status", "sWidth": "15%" },
                { "mDataProp": "CustomerFullName", "sTitle": "Customer Full Name", "sWidth": "15%" },
                { "mDataProp": "CustomerTypeDescription", "sTitle": "Customer Type", "sWidth": "15%" },
                {
                    "mDataProp": "CreatedDate",
                    "sTitle": "Created Date",
                    "sWidth": "15%",
                    "mRender": function (data) {
                        // Parse the date and format it
                        var createdDate = new Date(parseInt(data.replace("/Date(", "").replace(")/", ""), 10));
                        var h = ("0" + createdDate.getHours()).slice(-2);
                        var m = ("0" + createdDate.getMinutes()).slice(-2);
                        var s = ("0" + createdDate.getSeconds()).slice(-2);
                        return $.datepicker.formatDate('dd/mm/yy', createdDate) + " " + h + ":" + m + ":" + s;
                    }
                },
                {
                    "mDataProp": null,
                    "sTitle": "Action",
                    "sWidth": "15%",
                    "bSortable": false,
                    "mRender": function (data, type, row) {
                        return '<a href="#" class="btn btn-outline-info select-customer-account" data-id="' + row.Id + '">Select</a>';
                    }
                }
            ],
            "aaSorting": [[0, "desc"]]
        });

        // Handle the selection of a customer account
        $('#CustomerAccountsGrid tbody').on('click', '.select-customer-account', function () {
            var customerAccountId = $(this).data('id');

            // Make an AJAX GET request to fetch the customer account details
            $.ajax({
                url: '@Url.Action("GetCustomerAccountDetails", "InHouse", new { Area = "FrontOffice" })',
                type: 'GET',
                data: { customerAccountId: customerAccountId },
                success: function (response) {
                    console.log(response); // Check the structure of the response in the console

                    if (response.success) {
                        // Populate the form fields with the selected customer account details
                        $('#DebitCustomerAccountFullAccountNumber').val(response.data.customerAccountFullAccountNumber);
                        $('#AvailableBalance').val(response.data.availableBalance);
                        $('#DebitCustomerAccountId').val(response.data.customerAccountId);
                        $('#DebitCustomerAccountCustomerAccountTypeProductCode').val(response.data.DebitCustomerAccountCustomerAccountTypeProductCode);
                        $('#DebitCustomerAccountCustomerAccountTypeTargetProductId').val(response.data.DebitCustomerAccountCustomerAccountTypeTargetProductId);

                        // Optionally show the branch description somewhere in your view
                        $('#branchDescription').show();

                        // Close the modal
                        $('#customerAccountLookup').modal('hide');
                    } else {
                        alert(response.message);
                    }
                },
                error: function () {
                    alert('An error occurred while fetching the customer account details.');
                }
            });
        });
    });
    </script>






    <script>
        $(document).ready(function () {
    // Initialize the DataTable
    $('#ChequeTypeGrid').DataTable({
        "sPaginationType": "full_numbers",
        "bProcessing": true,
        "bServerSide": true,
        "sAjaxSource": '@Url.Action("Index", "ChequeType", new { Area = "Accounts" })',
        "sServerMethod": "POST",

        // Modify the rows and add a Select button
        "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
            var selectButton = '<a href="#" class="btn btn-outline-info select-cheque-type" data-cheque-type-id="' + aData.Id + '" data-cheque-type-description="' + aData.Description + '">Select</a>';
            $('td:eq(2)', nRow).html(selectButton);
            var createdDate = new Date(parseInt(aData.CreatedDate.replace("/Date(", "").replace(")/", ""), 10));
            var h = ("0" + createdDate.getHours()).slice(-2);
            var m = ("0" + createdDate.getMinutes()).slice(-2);
            var s = ("0" + createdDate.getSeconds()).slice(-2);
            var dt_Created = $.datepicker.formatDate('dd/mm/yy', createdDate) + " " + h + ":" + m + ":" + s;
            aData.CreatedDate = dt_Created;


            $('td:eq(1)', nRow).html(dt_Created);
            return nRow;
        },

        // Define columns
        "aoColumns": [
            { "mDataProp": "Description", "sTitle": "Cheque Type", "sWidth": "20%" },
            { "mDataProp": "CreatedDate", "sTitle": "Created Date", "sWidth": "10%" },
            { "mDataProp": null, "sTitle": "Select", "sWidth": "10%", "bSortable": false }
        ],
        "aaSorting": [[0, "desc"]]
    });

    // Handle cheque type selection
    $('#ChequeTypeGrid').on('click', '.select-cheque-type', function (e) {
        e.preventDefault();

        // Get the cheque type ID and description from the button's data attributes
        var chequeTypeId = $(this).data('cheque-type-id');
        var chequeTypeDescription = $(this).data('cheque-type-description');

        // Make the AJAX request to get the cheque type details (optional)
        $.ajax({
            url: '@Url.Action("GetChequeTypeDetails", "InHouse")', // Ensure this points to the correct action/controller
            type: 'GET',
            data: { chequeTypeId: chequeTypeId },
            success: function (response) {
                if (response.success) {
                    // Populate the form fields
                    $('#ChequeTypeDescription').val(response.chequeTypeDescription);
                    $('#ChequeTypeId').val(response.chequeTypeId);

                    // Close the modal after selection
                    $('#ChequeTypeLookupModal').modal('hide');
                } else {
                    alert(response.message); // Display any error messages
                }
            },
            error: function () {
                alert('An error occurred while fetching cheque type details.');
            }
        });
    });
});

    </script>


    <style>
        .highlight {
            background-color: #f0c14b; /* Light yellow color for highlighting */
        }
    </style>


    <script>
        $(document).ready(function () {
            const existingEntries = new Set(); // Set to track unique entries

            // Function to convert number to words in Shillings (unchanged)
            function numberToWords(amount) {
                const words = [
                    '', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten',
                    'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen',
                    'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety', 'Hundred'
                ];

                const convert = (n) => {
                    let result = '';
                    if (n < 20) {
                        result = words[n];
                    } else if (n < 100) {
                        result = words[20 + Math.floor(n / 10) - 2] + (n % 10 !== 0 ? ' ' + words[n % 10] : '');
                    } else if (n < 1000) {
                        result = words[Math.floor(n / 100)] + ' Hundred' + (n % 100 !== 0 ? ' and ' + convert(n % 100) : '');
                    } else if (n < 1000000) {
                        result = convert(Math.floor(n / 1000)) + ' Thousand' + (n % 1000 !== 0 ? ' ' + convert(n % 1000) : '');
                    }
                    return result;
                };

                const finalResult = convert(amount) + ' Shillings';
                return finalResult.charAt(0).toUpperCase() + finalResult.slice(1); // Capitalize first letter
            }

            // Function to pad the amount with XXXXX (unchanged)
            function padAmount(amount) {
                return 'XXXXX ' + amount;
            }

            // Handle the add button click
            $('#addEntryButton').click(function (e) {
                e.preventDefault(); // Prevent the default form submission

                // Gather form data
                var amountValue = parseFloat($('#Amount').val()) || 0; // Parse amount as float
                var wordifiedAmount = numberToWords(amountValue); // Convert amount to words
                var paddedAmount = padAmount($('#Amount').val()); // Pad the amount

                // Create a unique identifier for the entry
                var uniqueEntry = `${$('#DebitChartOfAccountAccountName').val()}-${$('#DebitCustomerAccountFullAccountNumber').val()}-${$('#ChequeTypeDescription').val()}`;

                if (existingEntries.has(uniqueEntry)) {
                    alert("This entry already exists.");
                    return; // Prevent further execution if entry exists
                }

                // Add the unique entry to the set
                existingEntries.add(uniqueEntry);

                var formData = {
                    BranchId: $('#BranchId').val(),
                    BranchDescription: $('#BranchDescription').val(),
                    FundingDescription: $('#FundingDescription').val(),
                    DebitChartOfAccountId: $('#DebitChartOfAccountId').val(),
                    DebitChartOfAccountAccountName: $('#DebitChartOfAccountAccountName').val(),
                    CostCenterId: $('#CostCenterId').val(),
                    CostCenter: $('#CostCenter').val(),
                    DebitCustomerAccountCustomerAccountTypeProductCode: $('#DebitCustomerAccountCustomerAccountTypeProductCode').val(),
                    DebitCustomerAccountCustomerAccountTypeTargetProductId: $('#DebitCustomerAccountCustomerAccountTypeTargetProductId').val(),
                    DebitCustomerAccountId: $('#DebitCustomerAccountId').val(),
                    DebitCustomerAccountFullAccountNumber: $('#DebitCustomerAccountFullAccountNumber').val(),
                    AvailableBalance: $('#AvailableBalance').val(),
                    ChequeTypeDescription: $('#ChequeTypeDescription').val(),
                    ChequeTypeId: $('#ChequeTypeId').val(),
                    Amount: amountValue, // Store as number
                    WordifiedAmount: wordifiedAmount, // Add wordified amount
                    PaddedAmount: paddedAmount, // Add padded amount
                    Payee: $('#Payee').val(),
                    Reference: $('#Reference').val(),
                    Chargeable: $('#applyCharges').prop('checked')
                };

                // Send the form data to the server using AJAX
                $.ajax({
                    url: '/InHouse/AddEntry', // Adjust the URL to your controller action
                    type: 'POST',
                    data: formData,
                    success: function (response) {
                        if (response.success) {
                            // Display success message
                            $('#popupMessage').show().delay(2000).fadeOut();

                            // Optionally, append the new entry to the table
                            var newRow = '<tr>' +
                                '<td><input type="checkbox" /></td>' +
                                '<td>' + formData.BranchDescription + '</td>' +
                                '<td>' + formData.ChequeTypeDescription + '</td>' +
                                '<td>' + formData.FundingDescription + '</td>' +
                                '<td>' + formData.DebitChartOfAccountAccountName + '</td>' +
                                '<td>' + formData.DebitCustomerAccountFullAccountNumber + '</td>' +
                                '<td>' + formData.Payee + '</td>' +
                                '<td>' + formData.Amount + '</td>' +
                                '<td>' + formData.WordifiedAmount + '</td>' +  // Add wordified amount
                                '<td>' + formData.PaddedAmount + '</td>' +    // Add padded amount
                                '<td>' + formData.Reference + '</td>' +
                                '</tr>';
                            $('#ExpensePayableEntries tbody').append(newRow);
                        }
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        alert('Error: ' + error);
                    }
                });

                // Clear form fields after adding transaction
                function clearFormFields() {
                    $('#DebitChartOfAccountAccountName').val('');
                    $('#CostCenter').val('');
                    $('#ChequeTypeDescription').val('');
                    $('#DebitCustomerAccountFullAccountNumber').val('');
                    $('#Payee').val('');
                    $('#Amount').val('');
                    $('#WordifiedAmount').val('');
                    $('#Reference').val('');
                    $('#Chargeable').prop('checked', false);
                }
                clearFormFields();
            });

            // Remove selected transaction
            $('#removeTransaction').click(function () {
                $('input[name="selectedTransaction"]:checked').closest('tr').remove();
                $('#removeTransaction').prop('disabled', true);
            });
        });
    </script>



    <script>
        $.ajax({
            url: '/InHouse/Create',
            type: 'POST',
            success: function (response) {
                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: response.message,
                        showConfirmButton: false,
                        timer: 2000
                    }).then(() => {
                        // Redirect or update page as needed
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: response.message
                    });
                }
            },
            error: function (xhr, status, error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An unexpected error occurred.'
                });
            }
        });


    </script>



    <script>
        $(document).ready(function () {
            // Event listener for the Add button
            $('#addEntryButton').on('click', function (e) {
                e.preventDefault();
                // Logic to add an entry to the table goes here
                $('#removeTransaction').prop('disabled', false);
                $('#popupMessage').fadeIn().delay(2000).fadeOut();
            });

            // Event listener for the Remove button
            $('#removeTransaction').on('click', function () {
                // Collect IDs of entries to remove
                const entriesToRemove = [];
                $('#ExpensePayableEntries tbody tr').each(function () {
                    if ($(this).find('input[type="checkbox"]').is(':checked')) {
                        const entryId = $(this).data('entry-id'); // Assuming each row has a data-entry-id attribute
                        if (entryId) {
                            entriesToRemove.push(entryId);
                        }
                        $(this).remove(); // Remove the row from the table
                    }
                });

                // Send AJAX request to remove entries from TempData
                if (entriesToRemove.length > 0) {
                    $.ajax({
                        url: '/InHouse/RemoveEntries', // Adjust the URL to your controller action
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(entriesToRemove),
                        success: function (response) {
                            if (response.success) {
                                // Successfully removed entries
                                if ($('#ExpensePayableEntries tbody tr').length === 0) {
                                    $('#removeTransaction').prop('disabled', true);
                                }
                            } else {
                                alert('Error removing entries: ' + response.errorMessage);
                            }
                        },
                        error: function (xhr, status, error) {
                            alert('Error: ' + error);
                        }
                    });
                }

                // Disable the remove button if no entries left
                if ($('#ExpensePayableEntries tbody tr').length === 0) {
                    $('#removeTransaction').prop('disabled', true);
                }
            });

            // Checkboxes in the table to select entries
            $('#ExpensePayableEntries').on('change', 'input[type="checkbox"]', function () {
                // Enable the Remove button if any checkbox is checked
                const hasChecked = $('#ExpensePayableEntries tbody input[type="checkbox"]:checked').length > 0;
                $('#removeTransaction').prop('disabled', !hasChecked);
            });
        });
    </script>







    <style>
        .container1 {
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
        }

            .summary-table td {
                padding: 10px;
                border: 1px solid #ddd;
            }

            .summary-table label {
                display: block;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .summary-table input {
                width: 100%;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
                background-color: #f9f9f9;
            }

        .tab-content {
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .tab-pane {
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 50px;
        }

        thead {
            background-color: #f5f5f5;
        }

            thead th {
                border: 1px solid #ddd;
                padding: 10px;
                text-align: center;
                font-style: italic;
                color: cadetblue;
            }

        tbody td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .btn-danger {
            color: #fff;
            background-color: #dc3545;
            border-color: #dc3545;
        }

            .btn-danger:hover {
                background-color: #c82333;
                border-color: #bd2130;
            }

        /* Ensure no border between tabs and tab content */
        .nav-tabs {
            border-bottom: none; /* Remove bottom border from tab navigation */
        }

            .nav-tabs .nav-link {
                border: none; /* Remove borders from tab links */
                border-radius: 0; /* Remove border radius for a cleaner look */
            }

        .tab-content {
            border-top: 1px solid #ddd; /* Add a subtle border if needed */
            padding: 15px; /* Optional: Add padding for spacing */
        }

        /* Optional: Add spacing between tab navigation and content */
        .container {
            margin-top: 20px; /* Adjust top margin as needed */
        }
    </style>






}