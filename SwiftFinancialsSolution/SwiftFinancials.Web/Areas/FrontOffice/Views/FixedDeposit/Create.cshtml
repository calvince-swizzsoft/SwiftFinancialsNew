@model Application.MainBoundedContext.DTO.FrontOfficeModule.FixedDepositDTO

@{ ViewBag.Title = "Create"; }

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Create Fixed Deposit</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">@Html.ActionLink("Dashboard", "Index", "Home")</li>
            <li class="breadcrumb-item">@Html.ActionLink("Home", "Index", "Create", new { Area = "FrontOffice" })</li>
            <li class="breadcrumb-item active"><strong>Create</strong></li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content bg-white">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content bg-white text-info">
                    @using (Html.BeginForm("Create", "FixedDeposit", new { Area = "FrontOffice" }, FormMethod.Post, new { @class = "wizard-big", @id = "form" }))
                    {
                @Html.AntiForgeryToken()

                                <div class="form-group row">
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.CustomerAccountFullAccountNumber)
                                        <div class="input-group">
                                            @Html.EditorFor(model => model.CustomerAccountFullAccountNumber, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Account Number..." } })
                                            <div class="input-group-append">
                                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#lookupModal">
                                                    <i class="fa fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.Value)
                                        @Html.EditorFor(model => model.Value, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Value..." } })
                                    </div>
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.Term)
                                        @Html.EditorFor(model => model.Term, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Term in Months..." } })
                                    </div>
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.Category)
                                        @Html.DropDownListFor(model => model.Category, new SelectList(new List<SelectListItem>
                                                                                                                                                                                            {
                                    new SelectListItem { Text = "Term Deposit", Value = "TermDeposit" },
                                    new SelectListItem { Text = "Call Deposit", Value = "CallDeposit" }
                                }), "Select Category", new { @class = "form-control" })
                                    </div>
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.Rate)
                                        @Html.EditorFor(model => model.Rate, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Annual Percentage Rate..." } })
                                    </div>
                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.Remarks)
                                        @Html.EditorFor(model => model.Remarks, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>
                                    <div class="form-group">
                                        <label for="MaturityAction">Maturity Action:</label>
                                        <select id="MaturityAction" class="form-control">
                                            <option value="PayPrincipalAndInterestDue">Pay Principal & Interest Due</option>
                                            <option value="PayInterestDueAndRolloverPrincipal">Pay Interest Due & Roll-over Principal</option>
                                            <option value="RolloverPrincipalAndInterestDue">Roll-over Principal & Interest Due</option>
                                        </select>
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.BranchDescription)
                                        @Html.EditorFor(model => model.BranchDescription, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.CustomerAccountStatusDescription)
                                        @Html.EditorFor(model => model.CustomerAccountStatusDescription, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerReference1)
                                        @Html.EditorFor(model => model.CustomerAccountCustomerReference1, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerReference2)
                                        @Html.EditorFor(model => model.CustomerAccountCustomerReference2, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerReference3)
                                        @Html.EditorFor(model => model.CustomerAccountCustomerReference3, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>

                                    <div class="col-md-3">
                                        @Html.LabelFor(model => model.CustomerAccountCustomerFullName)
                                        @Html.EditorFor(model => model.CustomerAccountCustomerFullName, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Remarks..." } })
                                    </div>


                                </div> <!-- Modal for Lookup for full account number-->
                                                <div class="modal fade" id="lookupModal" tabindex="-1" role="dialog" aria-labelledby="lookupModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="lookupModalLabel">Account Lookup</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <!-- Search Filters -->
                                                                <div class="row mb-3">
                                                                    <div class="col-md-4">
                                                                        <select id="searchField" class="form-control">
                                                                            <option value="Address Line 1">Address Line 1</option>
                                                                            <option value="Address Line 2">Address Line 2</option>
                                                                            <option value="City">City</option>
                                                                            <option value="Email">Email</option>
                                                                            <option value="First Name">First Name</option>
                                                                            <option value="Identity Card #">Identity Card #</option>
                                                                            <option value="Land Line">Land Line</option>
                                                                            <option value="Last Name">Last Name</option>
                                                                            <option value="Mobile Line">Mobile Line</option>
                                                                            <option value="Org. Name">Org. Name</option>
                                                                            <option value="Org. Registration #">Org. Registration #</option>
                                                                            <option value="Payroll Numbers">Payroll Numbers</option>
                                                                            <option value="Personal Identification #">Personal Identification #</option>
                                                                            <option value="Postal Code">Postal Code</option>
                                                                            <option value="Account Number">Account Number</option>
                                                                            <option value="Membership Number">Membership Number</option>
                                                                            <option value="Personal File Number">Personal File Number</option>
                                                                            <option value="Serial Number">Serial Number</option>
                                                                        </select>
                                                                    </div>

                                                                    <!-- Dropdown for selecting account type -->
                                                                    <select id="accountType">
                                                                        <option value="investments">Investments</option>
                                                                        <option value="loans">Loans</option>
                                                                        <option value="savings">Savings</option>
                                                                    </select>

                                                                </div>

                                                                <!-- Lookup Table -->
                                                                <table id="CustomerAccountsGrid" class="table table-striped table-bordered">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Branch</th>
                                                                            <th>Status</th>
                                                                            <th>Full Account Number</th>
                                                                            <th>Remarks</th>
                                                                            <th>Product Name</th>
                                                                            <th>Customer Type</th>
                                                                            <th>Membership Number</th>
                                                                            <th>Personal File Number</th>
                                                                            <th>Account Number</th>
                                                                            <th>Customer Name</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <!-- Data rows will be populated here -->

                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" id="refreshButton">Refresh</button>
                                                                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div> <!-- Tabs for Fixed Deposit Payables -->
                                                <ul class="nav nav-tabs">


                                                    <li class="nav-item">
                                                        <a class="nav-link active" data-toggle="tab" href="#FixedDepositPayable">Fixed Deposit Payables</a>

                                                    </li>


                                                </ul>
                                                <div class="tab-content">
                                                    <div class="tab-pane fade show active" id="fixedDepositPayable">
                                                        <div class="table-responsive">
                                                            <table class="table table-bordered">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Full Account Number</th>
                                                                        <th>Account Status</th>
                                                                        <th>Available Balance</th>
                                                                        <th>Customer</th>
                                                                        <th>Payroll Number</th>
                                                                        <th>Personal File Number</th>
                                                                        <th>Membership Number</th>
                                                                        <th>Ctegory</th>
                                                                        <th>Value</th>
                                                                        <th>Remarks</th>

                                                                        <th>Select</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @if (Model != null)
                                                                    {
                                                                        <tr>
                                                                            <td>@Html.DisplayFor(model => model.CustomerAccountFullAccountNumber)</td>
                                                                            <td>@Html.DisplayFor(model => model.CustomerAccountStatusDescription)</td>
                                                                            <td>@Html.DisplayFor(model => model.TotalExpected)</td>
                                                                            <td>@Html.DisplayFor(model => model.CustomerAccountCustomerId)</td>
                                                                            <td>@Html.DisplayFor(model => model.CustomerAccountCustomerIdentificationNumber)</td>
                                                                            <td>@Html.DisplayFor(model => model.CustomerAccountCustomerIndividualPayrollNumbers)</td>
                                                                            <td>@Html.DisplayFor(model => model.CustomerAccountCustomerReference1)</td>
                                                                            <td>@Html.DisplayFor(model => model.Category)</td>
                                                                            <td>@Html.DisplayFor(model => model.Value)</td>
                                                                            <td>@Html.DisplayFor(model => model.Remarks)</td>

                                                                        </tr>
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-12 text-right">
                                                    <button type="button" class="btn btn-primary">Create</button>
                                                </div>}


                </div>
            </div>
        </div>
    </div>
</div>


@section Styles{
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/plugins/wizardStepsStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/plugins/dateRangeStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/plugins/tagInputsStyles")
    @Styles.Render("~/plugins/duallistStyles")
}

@section Scripts{
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/validate")
    @Scripts.Render("~/plugins/typehead")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/tagInputs")
    @Scripts.Render("~/plugins/duallist")



    <script>
    $(document).ready(function () {
        var accountsMap = {}; // Initialize accounts map
        var addedEntries = []; // Array to hold added entries

        // Typeahead functionality
        $('.StationsLookup').typeahead({
            source: function (query, process) {
                return $.getJSON('@Url.Action("GetAccountNumbers", "FixedDeposit", new { Area = "FrontOffice" })', { query: query }, function (accounts) {
                    var newAccountsData = [];
                    accountsMap = {};
                    $.each(accounts, function (i, account) {
                        newAccountsData.push(account.FullAccountNumber);
                        accountsMap[account.FullAccountNumber] = account;
                    });
                    process(newAccountsData);
                });
            },
            updater: function (item) {
                var account = accountsMap[item]; // Get the selected account details
                // Auto-fill form fields with the selected account data
                $('#CustomerAccountFullAccountNumber').val(account.CustomerAccountFullAccountNumber);
                $('#CustomerAccountRemarks').val(account.Remarks);
                $('#CustomerAccountTypeTargetProductDescription').val(account.ProductName);
                $('#CustomerAccountCustomerId').val(account.CustomerId);
                $('#CustomerAccountCustomerTypeDescription').val(account.CustomerTypeDescription);
                $('#CustomerAccountCustomerIndividualPayrollNumbers').val(account.IndividualPayrollNumbers);
                $('#CustomerAccountCustomerReference3').val(account.CustomerReference3);
                $('#CustomerAccountCustomerIdentificationNumber').val(account.IdentificationNumber);
                $('#CustomerAccountCustomerReference1').val(account.CustomerReference1);
                $('#CustomerAccountCustomerReference2').val(account.CustomerReference2);
                $('#MaturityAction').val(account.MaturityAction);
                $('#lookupModal').modal('hide'); // Close the modal after selection
            }
        });

        // Add button click handler
        $('#addButton').click(function () {
            var entry = {
                FullAccountNumber: $('#CustomerAccountFullAccountNumber').val(),
                Remarks: $('#CustomerAccountRemarks').val(),
                ProductName: $('#CustomerAccountTypeTargetProductDescription').val(),
                CustomerId: $('#CustomerAccountCustomerId').val(),
                CustomerTypeDescription: $('#CustomerAccountCustomerTypeDescription').val(),
                IndividualPayrollNumbers: $('#CustomerAccountCustomerIndividualPayrollNumbers').val(),
                CustomerReference3: $('#CustomerAccountCustomerReference3').val(),
                IdentificationNumber: $('#CustomerAccountCustomerIdentificationNumber').val(),
                CustomerReference1: $('#CustomerAccountCustomerReference1').val(),
                CustomerReference2: $('#CustomerAccountCustomerReference2').val(),
                MaturityAction: $('#MaturityAction').val()
            };

            addedEntries.push(entry);
            updateAddedTransactionsTable();
        });

        // Function to update the added transactions table
        function updateAddedTransactionsTable() {
            var tbody = $('#AddedTransactionsTable tbody');
            tbody.empty();

            $.each(addedEntries, function (index, entry) {
                var row = `<tr data-index="${index}">
                    <td>${entry.FullAccountNumber}</td>
                    <td>${entry.Remarks}</td>
                    <td>${entry.ProductName}</td>
                    <td>${entry.CustomerId}</td>
                    <td>${entry.CustomerTypeDescription}</td>
                    <td>${entry.IndividualPayrollNumbers}</td>
                    <td>${entry.CustomerReference3}</td>
                    <td>${entry.IdentificationNumber}</td>
                    <td>${entry.CustomerReference1}</td>
                    <td>${entry.CustomerReference2}</td>
                    <td>${entry.Reason}</td>
                    <td>${entry.MaturityAction}</td>
                    <td><button class="remove-entry">Remove</button></td>
                </tr>`;
                tbody.append(row);
            });
        }

        // Remove button click handler within the table
        $('#AddedTransactionsTable').on('click', '.remove-entry', function () {
            var index = $(this).closest('tr').data('index');
            addedEntries.splice(index, 1);
            updateAddedTransactionsTable();
        });

        // Create button click handler
        $('#createButton').click(function (event) {
            event.preventDefault();

            // Add AJAX request here to send addedEntries to the server for processing

            alert('Operation successful.');

            // Reset the addedEntries array and update the table
            addedEntries = [];
            updateAddedTransactionsTable();
        });

        // DataTable for CustomerAccountsGrid
        $('#CustomerAccountsGrid').DataTable({
            "sPaginationType": "full_numbers",
            "bProcessing": true,
            "bServerSide": true,
            "sAjaxSource": "@Url.Action("Index", "CustomerAccounts", new { Area = "Accounts" })",
            "sServerMethod": "POST",
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                return nRow;
            },
            "columns": [
                { "data": "BranchDescription" },
                { "data": "StatusDescription" },
                { "data": "FullAccountNumber" },
                { "data": "Remarks" },
                { "data": "CustomerTypeDescription" },
                { "data": "CustomerAccountTypeTargetProductDescription" },
                { "data": "CustomerFullName" },
                { "data": "CustomerReference1" },
                { "data": "CustomerReference2" },
                { "data": "CustomerReference3" },
                {
                    "data": "Id",
                    "render": function (data) {
                        return '<button class="btn btn-outline-info select-account" data-id="' + data + '">Select</button>';
                    }
                }
            ]
        });

        // Select button click handler within the DataTable
        $('#CustomerAccountsGrid tbody').on('click', '.select-account', function () {
            var data = $('#CustomerAccountsGrid').DataTable().row($(this).parents('tr')).data();
            if (data) {
                populateFormFields(data);
                $('#lookupModal').modal('hide');
            }
        });

        // Function to populate form fields with selected data
        function populateFormFields(data) {
            $('#CustomerAccountFullAccountNumber').val(data.FullAccountNumber);
            $('#Remarks').val(data.Remarks);
            $('#CustomerAccountTypeTargetProductDescription').val(data.ProductName);
            $('#CustomerAccountCustomerId').val(data.CustomerId);
            $('#CustomerAccountCustomerTypeDescription').val(data.CustomerTypeDescription);
            $('#CustomerAccountCustomerIndividualPayrollNumbers').val(data.IndividualPayrollNumbers);
            $('#CustomerAccountCustomerReference3').val(data.CustomerReference3);
            $('#CustomerAccountCustomerIdentificationNumber').val(data.IdentificationNumber);
            $('#CustomerAccountCustomerReference1').val(data.CustomerReference1);
            $('#CustomerAccountCustomerReference2').val(data.CustomerReference2);
            $('#MaturityAction').val(data.MaturityAction);
        }
    });
    </script>


}
