@model Application.MainBoundedContext.DTO.FrontOfficeModule.ExpensePayableDTO

@{
    ViewBag.Title = "Create Expense Payable";
    ViewBag.DebitCreditOptions = new List<SelectListItem>
{
        new SelectListItem { Value = "Debit", Text = "Debit" },
        new SelectListItem { Value = "Credit", Text = "Credit" }
    };


}

<style>
    #tabs-container {
        background-color: whitesmoke;
        border-bottom: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Add a subtle box shadow */
        margin-bottom: 20px;
        overflow-x: auto; /* Allow horizontal scrolling if necessary */
        width: 50%;
    }

    .nav-tabs {
        padding: 10px 0; /* Adjusted padding */
        list-style: none;
        margin: 0;
        white-space: nowrap; /* Prevent line breaks */
    }

        .nav-tabs li {
            display: inline-block;
            margin-right: 20px;
        }

        .nav-tabs a {
            text-decoration: none;
            font-size: 14px;
            color: #333;
            font-weight: bold; /* Set font weight to bold */
            padding: 10px 15px;
            border-bottom: 2px solid transparent;
            transition: border-bottom-color 0.3s ease-in-out;
        }

            .nav-tabs a:hover,
            .nav-tabs a:active {
                border-bottom-color: #007bff;
                color: #007bff;
            }
</style>

<style>
    #ChargeSplits {
        width: 100%;
        border-collapse: collapse;
        font-family: Arial, sans-serif;
    }

        #ChargeSplits thead {
            background-color: white;
            color: #333;
            font-family: Arial, Helvetica, sans-serif;
        }

        #ChargeSplits th, #ChargeSplits td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        #ChargeSplits th {
            font-weight: bold;
        }

        #ChargeSplits tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #ChargeSplits tbody tr:hover {
            background-color: #f1f1f1;
        }
</style>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    $(document).ready(function () {
        // Initially activate the first tab
        $('.nav-tabs li:first-child a').addClass('active');
        $('#tab1').addClass('active');

        // Handle tab click event
        $('.tab-link').on('click', function (e) {
            e.preventDefault();

            // Deactivate all tabs
            $('.tab-link').removeClass('active');
            $('.tab-content').removeClass('active');

            // Activate the clicked tab
            $(this).addClass('active');
            $($(this).attr('href')).addClass('active');
        });

        // Datepicker Initialization
        $('#ValueDate').datepicker({
            format: 'mm/dd/yyyy',
            todayHighlight: true,
            autoclose: true
        });
    });
</script>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-12">
        <h1>Expense Payable</h1>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                @Html.ActionLink("Dashboard", "Index", "Home", new { Area = "" }, null)
            </li>
            <li class="breadcrumb-item">
                @Html.ActionLink("Home", "Index", "ExpensePayable", new { Area = "FrontOffice" }, null)
            </li>
            <li class="breadcrumb-item active">
                <strong>Create</strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h2>Create Expense Payable</h2>

                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success">
                            <strong>Success !</strong> @TempData["SuccessMessage"]
                        </div>
                    }

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger">
                            @TempData["ErrorMessage"]
                        </div>}


                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>

                <div class="ibox-content bg-white">
                    @using (Html.BeginForm("Add", "ExpensePayable", new { Area = "FrontOffice" }, FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()

                        <!-- Expense Payables -->
                        <fieldset>
                            <div class="ibox-content bg-white text-info">
                                <h1>Expense Payable Details</h1>

                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ExpensePayableAuthOptionDescription, new { @class = "control-label", @for = "ExpensePayableAuthOption_1" })
                                            <div class="input-group">
                                                <span class="input-group-addon">
                                                    <i class="fa fa-bars fa-fw"></i>
                                                </span>
                                                @Html.DropDownListFor(model => model.ExpensePayableAuthOptionDescription,
                                                    new SelectList(ViewBag.DebitCreditOptions, "Value", "Text"),
                                                    "Select",
                                                    new { @class = "form-control", @id = "ExpensePayableAuthOption_1" })
                                                @Html.ValidationMessageFor(model => model.ExpensePayableAuthOptionDescription)
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg text-center">
                                            @Html.LabelFor(model => model.ChartOfAccounts, htmlAttributes: new { @class = "control-label" })
                                            @Html.HiddenFor(model => model.ChartOfAccountId, new { id = "ChartOfAccountId" })
                                            @Html.EditorFor(model => model.ChartOfAccounts, new { htmlAttributes = new { @class = "ChartOfAccountsLookup form-control required", placeholder = "Chart of Account Name", id = "ChartOfAccounts" } })
                                            @Html.ValidationMessageFor(model => model.ChartOfAccounts, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.PostingPeriodDescription, htmlAttributes: new { @class = "control-label" })
                                            @Html.HiddenFor(model => model.PostingPeriodId, new { id = "PostingPeriodId" })
                                            @Html.EditorFor(model => model.PostingPeriodDescription, new { htmlAttributes = new { @class = "PostingPeriodsLookup form-control required", placeholder = "Posting Period Name", id = "PostingPeriodDescription" } })
                                            @Html.ValidationMessageFor(model => model.PostingPeriodDescription, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.TotalValue, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.TotalValue, new { htmlAttributes = new { @id = "TotalValue", @class = "form-control", @placeholder = "Principal", @required = "" } })
                                            @Html.ValidationMessageFor(model => model.TotalValue, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ValueDate, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.ValueDate, new { htmlAttributes = new { @class = "form-control datepicker", placeholder = "Value Date", id = "ValueDate", required = "required" } })
                                            <span id="ValueDateError" class="text-danger" style="display:none;"></span> <!-- Error message element -->
                                            @Html.ValidationMessageFor(model => model.ValueDate, "", new { @class = "text-danger" })
                                        </div>
                                    </div>







                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.Remarks, htmlAttributes: new { @class = "control-label" })
                                            @Html.TextAreaFor(model => model.Remarks, new { @rows = 3, @class = "form-control", @placeholder = "Enter remarks", @required = "" })
                                        </div>
                                    </div>
                                </div>

                                <br />
                                <hr />

                                <h2 style="color: cadetblue;">Expense Payable Entries</h2>

                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ExpensePayableEntry.ChartOfAccountName, htmlAttributes: new { @class = "control-label" })
                                            @Html.HiddenFor(model => model.ExpensePayableEntry.ChartOfAccountId, new { id = "ExpensePayableEntry_ChartOfAccountId" })
                                            @Html.EditorFor(model => model.ExpensePayableEntry.ChartOfAccountName, new { htmlAttributes = new { @class = "ChartOfAccountsLookup form-control required", placeholder = "Enter space to autofill G/L Account...", id = "ExpensePayableEntry_ChartOfAccountAccountName" } })
                                            @Html.ValidationMessageFor(model => model.ExpensePayableEntry.ChartOfAccountName, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="col-lg-4 text-center">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ExpensePayableEntry.Reference, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.ExpensePayableEntry.Reference, new { htmlAttributes = new { @id = "mainReference", @class = "form-control", @placeholder = "Reference", @required = "" } })
                                            @Html.ValidationMessageFor(model => model.ExpensePayableEntry.Reference, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="col-lg-4 text-center">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ExpensePayableEntry.SecondaryDescription, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.ExpensePayableEntry.SecondaryDescription, new { htmlAttributes = new { @id = "mainSecondaryDescription", @class = "form-control", @placeholder = "Secondary description", @required = "" } })
                                            @Html.ValidationMessageFor(model => model.ExpensePayableEntry.SecondaryDescription, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-lg-4 text-center">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ExpensePayableEntry.PrimaryDescription, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.ExpensePayableEntry.PrimaryDescription, new { htmlAttributes = new { @id = "mainPrimaryDescription", @class = "form-control", @placeholder = "Primary description", @required = "" } })
                                            @Html.ValidationMessageFor(model => model.ExpensePayableEntry.PrimaryDescription, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="col-lg-4 text-center">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.ExpensePayableEntry.Value, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.ExpensePayableEntry.Value, new { htmlAttributes = new { @id = "mainValue", @class = "form-control", @placeholder = "Value", @required = "" } })
                                            @Html.ValidationMessageFor(model => model.ExpensePayableEntry.Value, "", new { @class = "text-danger" })
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="form-group form-group-lg">
                                            @Html.LabelFor(model => model.BranchDescription, htmlAttributes: new { @class = "control-label" })
                                            @Html.HiddenFor(model => model.BranchId, new { id = "BranchId" })
                                            @Html.EditorFor(model => model.BranchDescription, new { htmlAttributes = new { @id = "BranchDescription", @class = "ExpensePayableEntryBranchesLookup form-control required", placeholder = "Branch Name" } })
                                            @Html.ValidationMessageFor(model => model.BranchDescription, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <br />
                                <hr />

                                <div class="row d-flex justify-content-end">
                                    <div class="col-lg-3">
                                        <div class="form-group form-group-sm">
                                            <input type="submit" value="Add" style="width: 100px;" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </div>

                                <div class="container mt-4">
                                    <!-- Tab Navigation -->
                                    <ul class="nav nav-tabs" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="entries-tab" data-toggle="tab" href="#entries" role="tab" aria-controls="entries" aria-selected="true">Entries</a>
                                        </li>
                                    </ul>

                                    <!-- Tab Content -->
                                    <div class="tab-content mt-3">
                                        <div class="tab-pane fade show active" id="entries" role="tabpanel" aria-labelledby="entries-tab">
                                            <!-- Table for Entries -->
                                            <table id="ExpensePayableEntries" class="footable table table-striped toggle-arrow-tiny grey-table" style="color: black; width: 100%;">
                                                <thead style="font-style: italic; color: cadetblue; text-align: center;">
                                                    <tr>
                                                        <th style="width: 15%">Branch</th>
                                                        <th style="width: 15%;">G/L Account Name</th>
                                                        <th style="width: 10%;">Reference</th>
                                                        <th style="width: 20%;">Primary description</th>
                                                        <th style="width: 20%;">Secondary description</th>
                                                        <th style="width: 10%;">Value</th>
                                                        <th style="width: 5%;">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (ViewBag.ExpensePayableEntryDTOs != null)
                                                    {
                                                        foreach (var entry in ViewBag.ExpensePayableEntryDTOs)
                                                        {
                                                            <tr id="row-@entry.Id">
                                                                <td>@entry.BranchDescription</td>
                                                                <td>@entry.ChartOfAccountName</td>
                                                                <td>@entry.Reference</td>
                                                                <td>@entry.PrimaryDescription</td>
                                                                <td>@entry.SecondaryDescription</td>
                                                                <td>@String.Format("{0:C}", entry.Value)</td>
                                                                <td>
                                                                    <button type="button" class="btn btn-danger btn-sm" onclick="removeEntry('@entry.Id')">Remove</button>
                                                                </td>
                                                            </tr>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <tr>
                                                            <td colspan="7" class="text-center">No entries added yet.</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>



                                <br />
                                <hr />

                                <!-- Account Summary -->
                                <div class="container1">
                                    <h2>ACCOUNT SUMMARY</h2>
                                    <table class="summary-table">
                                        <tr>
                                            <td>
                                                <label for="Appropotioned">Appropotioned Amount:</label>
                                                <input type="text" id="Appropotioned" placeholder="Appropotioned" readonly>
                                            </td>
                                            <td>
                                                <label for="Shortage">Shortage Amount:</label>
                                                <input type="text" id="Shortage" placeholder="Shortage" readonly>
                                            </td>
                                        </tr>
                                    </table>
                                </div>






                            </div>
                        </fieldset>



                    }

                    @using (Html.BeginForm("Create", "ExpensePayable", new { Area = "FrontOffice" }, FormMethod.Post))
                    {
                        <div class="ibox-content bg-white text-info">
                            <div class="col-lg-3" style="float: right;">
                                <input type="submit" style="width: 100px;" value="Create" class="btn btn-primary" />
                            </div>
                        </div>
                    }

                </div>


            </div>
        </div>
    </div>
</div>




@section Styles{
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/plugins/wizardStepsStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/plugins/dateRangeStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/plugins/tagInputsStyles")
    @Styles.Render("~/plugins/duallistStyles")
    @Styles.Render("~/Content/plugins/jqueryValidationStyles")
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
}

@section Scripts{
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/validate")
    @Scripts.Render("~/plugins/typehead")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/tagInputs")
    @Scripts.Render("~/plugins/duallist")
    @Scripts.Render("~/plugins/jquery")
    @Scripts.Render("~/plugins/jqueryValidate")
    @Scripts.Render("~/plugins/jqueryValidateUnobtrusive")


    //typehead initialization

    <
    <script>
$(document).ready(function () {
    // Initialize typeahead for Chart of Accounts
    function initChartOfAccountTypeahead(selector, hiddenFieldId) {
        var ChartOfAccountsMap = {};  // Define the map outside the scope of the typeahead
        $(selector).typeahead({
            source: function (query, process) {
                return $.getJSON(
                    '@Url.Action("GetChartOfAccountsAsync", "ChartOfAccount", new { Area = "Accounts" })',
                    { query: query },
                    function (ChartOfAccounts) {
                        var newChartOfAccountsData = [];
                        ChartOfAccountsMap = {};

                        $.each(ChartOfAccounts, function (i, ChartOfAccount) {
                            newChartOfAccountsData.push(ChartOfAccount.AccountName);
                            ChartOfAccountsMap[ChartOfAccount.AccountName] = ChartOfAccount;
                        });
                        process(newChartOfAccountsData);
                    }
                );
            },
            matcher: function (item) {
                return item.toLowerCase().indexOf(this.query.trim().toLowerCase()) !== -1;
            },
            sorter: function (items) {
                return items.sort();
            },
            highlighter: function (item) {
                var regex = new RegExp('(' + this.query + ')', 'gi');
                return item.replace(regex, "<strong>$1</strong>");
            },
            updater: function (item) {
                var chartOfAccount = ChartOfAccountsMap[item];
                if (chartOfAccount) {
                    $('#' + hiddenFieldId).val(chartOfAccount.Id);

                }
                return item;
            }
        });
    }

    // Initialize typeahead for both fields
    initChartOfAccountTypeahead('#ChartOfAccounts', 'ChartOfAccountId');
    initChartOfAccountTypeahead('#ExpensePayableEntry_ChartOfAccountAccountName', 'ExpensePayableEntry_ChartOfAccountAccountName');
});
    </script>



    <script>

        $(document).ready(function () {
    // Initialize the steps wizard
    $("#wizard").steps();
    $("#form").steps({
        bodyTag: "fieldset",
        onStepChanging: function (event, currentIndex, newIndex) {
            if (currentIndex > newIndex) {
                return true;
            }

            if (newIndex === 3 && Number($("#age").val()) < 18) {
                return false;
            }

            var form = $(this);

            if (currentIndex < newIndex) {
                $(".body:eq(" + newIndex + ") label.error", form).remove();
                $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
            }

            form.validate().settings.ignore = ":disabled,:hidden";

            return form.valid();
        },
        onStepChanged: function (event, currentIndex, priorIndex) {
            if (currentIndex === 2 && Number($("#age").val()) >= 18) {
                $(this).steps("next");
            }

            if (currentIndex === 2 && priorIndex === 3) {
                $(this).steps("previous");
            }
        },
        onFinishing: function (event, currentIndex) {
            var form = $(this);

            form.validate().settings.ignore = ":disabled";

            return form.valid();
        },
        onFinished: function (event, currentIndex) {
            var form = $(this);

            form.submit();
        }
    }).validate({
        errorPlacement: function (error, element) {
            element.before(error);
        },
        rules: {
            confirm: {
                equalTo: "#password"
            }
        }
    });

            // Function to check for duplicate entries
            function isDuplicateEntry(branchDescription, chartOfAccount, reference, primaryDescription, secondaryDescription, formattedValue) {
                var isDuplicate = false;
                $('#ExpensePayableEntries tbody tr').each(function () {
                    var existingBranchDescription = $(this).find('td').eq(0).text().trim();
                    var existingChartOfAccount = $(this).find('td').eq(1).text().trim();
                    var existingReference = $(this).find('td').eq(2).text().trim();
                    var existingPrimaryDescription = $(this).find('td').eq(3).text().trim();
                    var existingSecondaryDescription = $(this).find('td').eq(4).text().trim();
                    var existingValue = $(this).find('td').eq(5).text().trim();

                    if (branchDescription === existingBranchDescription &&
                        chartOfAccount === existingChartOfAccount &&
                        reference === existingReference &&
                        primaryDescription === existingPrimaryDescription &&
                        secondaryDescription === existingSecondaryDescription &&
                        formattedValue === existingValue) {
                        isDuplicate = true;
                        return false; // Exit loop early
                    }
                });
                return isDuplicate;
            }

            // Add Entry
            $('#addEntryButton').click(function (e) {
                e.preventDefault();

                // Capture data from form fields
                var branchDescription = $('#BranchDescription').val();
                var chartOfAccount = $('#ExpensePayableEntry_ChartOfAccountAccountName').val();
                var reference = $('#mainReference').val();
                var primaryDescription = $('#mainPrimaryDescription').val();
                var secondaryDescription = $('#mainSecondaryDescription').val();
                var value = $('#mainValue').val();

                // Ensure all required fields have values
                if (!branchDescription || !chartOfAccount || !reference || !primaryDescription || !value) {
                    alert("Please fill in all required fields.");
                    return;
                }

                // Format value as currency
                var formattedValue = parseFloat(value).toFixed(2); // Ensure value is formatted consistently

                // Check for duplicate entries
                if (isDuplicateEntry(branchDescription, chartOfAccount, reference, primaryDescription, secondaryDescription, formattedValue)) {
                    alert("This entry already exists in the table.");
                    return;
                }

                // Create new row
                var newRow = '<tr>' +
                    '<td>' + branchDescription + '</td>' +
                    '<td>' + chartOfAccount + '</td>' +
                    '<td>' + reference + '</td>' +
                    '<td>' + primaryDescription + '</td>' +
                    '<td>' + secondaryDescription + '</td>' +
                    '<td class="amount">' + formattedValue + '</td>' + // Use a class for easy targeting
                    '<td class="text-center">' +
                    '<button type="button" class="btn btn-danger remove-entry">' +
                    '<i class="fa fa-times"></i>' +
                    '</button>' +
                    '</td>' +
                    '</tr>';

                // Append the new row to the table
                $('#ExpensePayableEntries tbody').append(newRow);

                // Update amounts after adding the entry
                updateAmounts();
            });

            // Delegate event handler for dynamically added remove buttons
            $('#ExpensePayableEntries').on('click', '.remove-entry', function () {
                var row = $(this).closest('tr');
                row.remove();
                updateAmounts(); // Update amounts after removal
            });


    // Remove Entry


    // Initialize typeahead for various fields
    function initTypeahead(selector, url, hiddenFieldId) {
        var dataMap = {};
        $(selector).typeahead({
            source: function (query, process) {
                return $.getJSON(url, { query: query }, function (data) {
                    var newData = [];
                    dataMap = {};
                    $.each(data, function (i, item) {
                        newData.push(item.Description);
                        dataMap[item.Description] = item;
                    });
                    process(newData);
                });
            },
            matcher: function (item) {
                return item.toLowerCase().indexOf(this.query.trim().toLowerCase()) !== -1;
            },
            sorter: function (items) {
                return items.sort();
            },
            highlighter: function (item) {
                var regex = new RegExp('(' + this.query + ')', 'gi');
                return item.replace(regex, "<strong>$1</strong>");
            },
            updater: function (item) {
                var data = dataMap[item];
                if (data) {
                    $('#' + hiddenFieldId).val(data.Id); // Update the hidden input with the selected ID
                }
                return item;
            }
        });
    }

    initTypeahead('.PostingPeriodsLookup', '@Url.Action("GetPostingPeriodsAsync", "PostingPeriod", new { Area = "Accounts" })', 'PostingPeriodId');
    initTypeahead('.ChartOfAccountsLookup', '@Url.Action("GetChartOfAccountsAsync", "ChartOfAccount", new { Area = "Accounts" })', 'ExpensePayableEntry_ChartOfAccountId');
    initTypeahead('.ExpensePayableEntryBranchesLookup', '@Url.Action("GetBranchesAsync", "Branch", new { Area = "Admin" })', 'BranchId');
});
    </script>

    <script>
        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "ExpensePayable")',
            data: { id: id },
            success: function (response) {
        if (response.success) {
            // Redirect to the index page
            window.location.href = response.redirectUrl;
        } else {
            // Display the error message
            alert(response.message);
        }
    },
    error: function () {
        alert("An error occurred while processing your request.");
    }
});

    </script>

    //ajax form submisstion
    <script>
       $(document).ready(function () {
    $('#form').submit(function (e) {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: '@Url.Action("Create", "ExpensePayable")',
            data: $(this).serialize(),
            success: function (response) {
                if (response.success) {
                    // Redirect to the Index page of the ExpensePayable controller
                    window.location.href = '@Url.Action("Index", "ExpensePayable")';
                } else {
                    alert(response.message);
                }
            },
            error: function () {
                alert("An error occurred while processing your request.");
            }
        });
    });
});


    </script>



    <script>
        $(document).ready(function () {
            // Set allowed date range
            var minDate = new Date("2024-01-01");
            var maxDate = new Date("2024-12-31");

            // Monitor changes in the ValueDate input field
            $("#ValueDate").on("change", function () {
                // Parse the selected date
                var selectedDate = new Date($(this).val());

                // Check if the selected date is out of range
                if (selectedDate < minDate || selectedDate > maxDate || selectedDate > new Date()) {
                    $("#ValueDateError").text("Sorry, but the value date is out of range!").show();
                    $(this).addClass("is-invalid"); // Optional: add invalid class for styling
                } else {
                    $("#ValueDateError").text("").hide();
                    $(this).removeClass("is-invalid"); // Optional: remove invalid class for styling
                }
            });
        });
    </script>



    <script type="text/javascript">
    // Function to remove an entry via AJAX and update the amounts
    function removeEntry(id) {
        if (confirm("Are you sure you want to remove this entry?")) {
            $.ajax({
                url: '@Url.Action("RemoveEntry", "ExpensePayable")',
                type: 'POST',
                data: { id: id },
                success: function (result) {
                    if (result.success) {
                        // Remove the row from the table
                        $('#row-' + id).remove();

                        // Update the amounts after removal
                        updateAmounts();
                    } else {
                        alert("Error: " + result.message);
                    }
                },
                error: function () {
                    alert("An error occurred while trying to remove the entry.");
                }
            });
        }
    }

    // Function to update amounts
    function updateAmounts() {
        var totalAmount = 0;
        var amountCells = $('#ExpensePayableEntries tbody tr td:nth-child(6)'); // Get all value cells

        // Calculate the total amount from the entries
        amountCells.each(function () {
            var text = $(this).text();
            var amount = parseFloat(text.replace(/[^0-9.-]/g, '')); // Clean the text
            if (!isNaN(amount)) {
                totalAmount += amount;
            }
        });

        // Get the elements for Total Value, Appropotioned, and Shortage
        var totalValueElement = $('[name="TotalValue"]');
        var appropotionedElement = $('#Appropotioned');
        var shortageElement = $('#Shortage');

        // Get the total value input by the user
        var totalValue = parseFloat(totalValueElement.val()) || 0;

        // Update the Appropotioned field
        appropotionedElement.val(totalAmount.toFixed(2));

        // Calculate and update the Shortage field
        var shortage = totalValue - totalAmount;
        if (shortage < 0) {
            shortage = 0;
            alert('Appropotioned amount exceeds the total value!');
        }
        shortageElement.val(shortage.toFixed(2));
    }

    // Function to add a new entry
    function addEntry(entryData) {
        updateAmounts(); // Ensure the amounts are updated before adding a new entry

        var appropotionedAmount = parseFloat($('#Appropotioned').val()) || 0;
        var totalValue = parseFloat($('[name="TotalValue"]').val()) || 0;

        // Check if adding this entry would exceed the Total Value
        if (appropotionedAmount + entryData.value > totalValue) {
            alert("Cannot add this entry. The Appropotioned Amount would exceed the Total Value.");
            return false; // Prevent adding the entry
        }

        // Code to add the entry (e.g., add a new row in the table)
        // ...

        updateAmounts(); // Update amounts after adding the entry
    }

    // Ensure this function runs whenever the relevant entries are updated
    $(document).ready(function () {
        // Call updateAmounts when the page loads
        updateAmounts();

        // Update amounts when any input in the table is changed
        $('#ExpensePayableEntries').on('change', 'input, select, textarea', function () {
            updateAmounts();
        });

        // Example usage: Call addEntry when a new entry is being added
        $('#addEntryButton').on('click', function () {
            var entryData = {
                value: parseFloat($('#newEntryValue').val()) || 0, // Assuming there's an input for the new entry value
                // Other entry data...
            };

            addEntry(entryData); // Attempt to add the new entry
        });

        // Update amounts if new rows are dynamically added to the table
        $('#ExpensePayableEntries').on('DOMNodeInserted', 'tr', function () {
            updateAmounts();
        });

        // Update amounts when a row is removed using the AJAX removeEntry function
        $('#ExpensePayableEntries').on('click', '.remove-entry', function () {
            var id = $(this).data('id'); // Assuming the button has a data-id attribute
            removeEntry(id);
        });
    });
    </script>



    












    <style>
        .table-container {
            display: none;
            overflow-x: auto; /* Enable horizontal scrolling */
        }

        table {
            border-collapse: collapse;
            white-space: nowrap; /* Prevent line breaks in table cells */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #Guarantors {
            table-layout: fixed; /* Forces the table to use the fixed layout algorithm */
        }

            #Guarantors th, #Guarantors td {
                white-space: nowrap; /* Prevents wrapping of text within cells */
                overflow: hidden; /* Hides any content that exceeds the cell dimensions */
                text-overflow: ellipsis; /* Displays an ellipsis (...) when content overflows */
                padding: 8px; /* Adjust padding as needed */
            }


        /* Styling for the button */
        .toggle-button {
            cursor: pointer;
            padding: 10px 20px;
            background-color: darkgreen;
            color: #fff;
            border: none;
            border-radius: 5px;
            outline: none;
        }
        /* Styling for the section */
        .section {
            display: none;
            margin-top: 20px;
        }

            .section.open {
                display: block;
            }





        .custom-button {
            display: flex;
            align-items: center;
            background: linear-gradient(45deg, #4CAF50, #2E7D32);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 16px;
            font-family: 'Arial', sans-serif;
            color: white;
            cursor: not-allowed;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background 0.3s ease, transform 0.3s ease;
        }

            .custom-button:disabled {
                background: linear-gradient(45deg, #9E9E9E, #616161);
            }

            .custom-button .button-icon {
                width: 24px;
                height: 24px;
                margin-right: 10px;
            }

            .custom-button:hover:enabled {
                background: linear-gradient(45deg, #66BB6A, #388E3C);
                transform: translateY(-2px);
            }
    </style>

}







