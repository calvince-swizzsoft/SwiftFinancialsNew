@model Application.MainBoundedContext.DTO.GeneralLedgerTransaction

@{
    ViewBag.Title = "G/L Account Transactions Journal";
    var accountTypes = ViewBag.CustomerTypeSelectList as List<SelectListItem>;
}

<div class="page-header">
    <h1>G/L Account Transactions Journal</h1>
</div>

<style>
    body {
        font-family: Arial, sans-serif;
    }

    .form-row {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    .form-group label {
        font-weight: bold;
    }

    .table-container {
        margin-top: 10px;
    }

    .summary-box {
        border: 2px solid #ccc;
        padding: 10px;
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
        background-color: #f9f9f9;
    }

    .pagination-container {
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
    }

    .filter-form {
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

        .filter-form input, .filter-form select {
            margin-bottom: 10px;
        }
</style>
<!-- Top Filters -->
<!--<div class="form-row">
    <div class="col-md-4 form-group">
        @Html.LabelFor(model => model.GLAccountName, htmlAttributes: new { @class = "control-label" })
        @Html.HiddenFor(model => model.GLAccountId)
        @Html.EditorFor(model => model.GLAccountName, new { htmlAttributes = new { @class = "ChartOfAccountsLookup form-control required", @placeholder = "Enter space to autofill G/L Account" } })
        @Html.ValidationMessageFor(model => model.GLAccountName, "", new { @class = "text-danger" })
    </div>
    <div class="col-md-4 form-group">
        @Html.LabelFor(model => model.GLAccountType, htmlAttributes: new { @class = "control-label" })
        @Html.EditorFor(model => model.GLAccountType, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Bank Branch name", @readonly = "readonly" } })
    </div>
    <div class="col-md-4 form-group">
        @Html.LabelFor(model => model.GLAccountCode, htmlAttributes: new { @class = "control-label" })
        @Html.EditorFor(model => model.GLAccountCode, new { htmlAttributes = new { @class = "form-control", @placeholder = "Enter Bank Branch name", @readonly = "readonly" } })
    </div>
</div>-->
<!-- Transactions Table -->
<div class="table-container">
    <table id="TransactionsGrid" class="table table-striped table-bordered table-hover" width="100%">
        <thead>
            <tr>
                <th>Branch</th>
                <th>Transaction Date</th>
                <th>Primary Description</th>
                <th>Debit</th>
                <th>Credit</th>
                <th>Running Balance</th>
                <th>Contra G/L Account</th>
                <th>Secondary</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="8" class="dataTables_empty">Loading data from server</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Summary Box -->
<div class="summary-box">
    <div>Balance B/F: <span id="balanceBF">Ksh. 644.45</span></div>
    <div>Debits: <span id="debits">Ksh. 0.00</span></div>
    <div>Credits: <span id="credits">Ksh. 0.00</span></div>
    <div>Balance C/F: <span id="balanceCF">Ksh. 644.45</span></div>
</div>

<!-- Filter Form -->
<div class="filter-form">
    <div class="form-row">
        <div class="form-group col-md-4">
            <label for="startDate">Start Date</label>
            <input type="text" class="form-control" id="startDate" placeholder="DD/MM/YYYY">
        </div>
        <div class="form-group col-md-4">
            <label for="endDate">End Date</label>
            <input type="text" class="form-control" id="endDate" placeholder="DD/MM/YYYY">
        </div>
        <div class="form-group col-md-4">
            <div style="display: flex; gap: 20px; align-items: center;">
                <label for="customerFilter" style="white-space: nowrap; font-weight: bold;">Advanced</label>
                @Html.DropDownList("Filter", accountTypes, "Search",
                    new { @class = "form-control", @id = "filter", style = "width: 100%;" })
            </div>
        </div>
        <div class="form-group col-md-4">
            <label for="reference">Reference</label>
            <input type="text" class="form-control" id="reference" placeholder="Enter Reference">
        </div>
    </div>
    <div class="text-right">
        <button type="button" class="btn btn-primary" id="refreshData">Refresh</button>
    </div>
</div>
@section Styles{
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/plugins/wizardStepsStyles")
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
    @Styles.Render("~/plugins/awesomeCheckboxStyles")
    @Styles.Render("~/plugins/clockpickerStyles")
    @Styles.Render("~/plugins/dateRangeStyles")
    @Styles.Render("~/Content/plugins/chosen/chosenStyles")
    @Styles.Render("~/plugins/switcheryStyles")
    @Styles.Render("~/plugins/jasnyBootstrapStyles")
    @Styles.Render("~/plugins/nouiSliderStyles")
    @Styles.Render("~/plugins/dataPickerStyles")
    @Styles.Render("~/Content/plugins/ionRangeSlider/ionRangeStyles")
    @Styles.Render("~/plugins/imagecropperStyles")
    @Styles.Render("~/Content/plugins/colorpicker/colorpickerStyles")
    @Styles.Render("~/plugins/select2Styles")
    @Styles.Render("~/plugins/touchSpinStyles")
    @Styles.Render("~/plugins/tagInputsStyles")
    @Styles.Render("~/plugins/duallistStyles")
}

@section Scripts{
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/validate")
    @Scripts.Render("~/plugins/typehead")
    @Scripts.Render("~/plugins/dataTables")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/dataPicker")
    @Scripts.Render("~/plugins/ionRange")
    @Scripts.Render("~/plugins/nouiSlider")
    @Scripts.Render("~/plugins/jasnyBootstrap")
    @Scripts.Render("~/plugins/switchery")
    @Scripts.Render("~/plugins/chosen")
    @Scripts.Render("~/plugins/knob")
    @Scripts.Render("~/plugins/imagecropper")
    @Scripts.Render("~/plugins/colorpicker")
    @Scripts.Render("~/plugins/clockpicker")
    @Scripts.Render("~/plugins/dateRange")
    @Scripts.Render("~/plugins/select2")
    @Scripts.Render("~/plugins/touchSpin")
    @Scripts.Render("~/plugins/tagInputs")
    @Scripts.Render("~/plugins/duallist")
    <script>
    $(document).ready(function () {
        var dataTable = $('#TransactionsGrid').DataTable({
            "pagingType": "full_numbers",
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": "@Url.Action("Index", "TransactionJournals", new { Area = "Accounts" })",
                "type": "POST",
                "data": function (d) {
                    // Add custom parameters to the request
                    d.startDate = $('#startDate').val() ? $('#startDate').val() : null;
                    d.endDate = $('#endDate').val() ? $('#endDate').val() : null;
                    d.reference = $('#reference').val() ? $('#reference').val() : null;
                    d.reference = $('#filter').val() ? $('#filter').val() : null;

                }
            },
            "columns": [
                { "mDataProp": "BranchDescription", "sTitle": "Branch", "sWidth": "15%" },
                { "mDataProp": "TransactionDate", "sTitle": "Transaction Date", "sWidth": "15%" },
                { "mDataProp": "PrimaryDescription", "sTitle": "Primary Description", "sWidth": "20%" },
                { "mDataProp": "Debit", "sTitle": "Debit", "sWidth": "10%" },
                { "mDataProp": "Credit", "sTitle": "Credit", "sWidth": "10%" },
                { "mDataProp": "RunningBalance", "sTitle": "Running Balance", "sWidth": "10%" },
                { "mDataProp": "ContraGLAccountName", "sTitle": "Contra G/L Account", "sWidth": "10%" },
                { "mDataProp": "Secondary", "sTitle": "Secondary", "sWidth": "10%" }
            ],
            "order": [[0, "desc"]],
            "language": {
                "emptyTable": "No records available.",
                "processing": "Loading..."
            }
        });

        // Refresh DataTable when filters are changed
        $('#refreshData').on('click', function () {
            dataTable.ajax.reload();
        });

        // Initialize DatePicker
        $('.datepicker').datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true
        });
    });
    </script>

    @*<script>
    $(document).ready(function () {
        var dataTable = $('#TransactionsGrid').DataTable({
            "pagingType": "full_numbers", // Updated for clarity
            "processing": true,
            "serverSide": true,

            "ajax": {
                "url": "@(Url.Action("Index", "TransactionJournals", new { Area = "Accounts" }))",
                "type": "POST"
            },
            "columns": [
                { "data": "Description", "title": "Zone", "width": "10%" },
                { "data": "DivisionDescription", "title": "Division", "width": "10%" },
                { "data": "DivisionEmployerDescription", "title": "Employer", "width": "10%" },
                { "data": "Stations[0].Description", "title": "Station", "width": "10%" },
                { "data": "Stations[0].AddressEmail", "title": "Station Email", "width": "15%" },
                { "data": "Stations[0].AddressMobileLine", "title": "Station Mobile No", "width": "15%" },
                { "data": "CreatedDate", "title": "Created Date", "width": "15%" },
                {
                    "data": "CreatedDate",
                    "title": "",
                    "width": "10%",
                    "sortable": false,
                    "render": function(data, type, row) {
                        return `<button class="btn btn-primary btn-sm view-details" data-id="${row.Id}">View</button>`;
                    }
                }
            ],
            "order": [[0, "desc"]], // Updated for clarity
            "language": {
                "emptyTable": "No records available.",
                "processing": "Loading..."
            }
        });

        // Example: Adding a click event for the View button
        $('#TransactionsGrid').on('click', '.view-details', function () {
            var id = $(this).data('id');
            alert('View details for ID: ' + id);
        });
    });
    </script>*@

    @*<script type="text/javascript">

                $(document).ready(function () {
                    $('#zonesGrid').DataTable({
                        // Ajax settings
                        "sPaginationType": "full_numbers",
                        "bProcessing": true,
                        "bServerSide": true,
                        "sAjaxSource": "@(Url.Action("Index", "Zone", new { Area = "Registry"}))",
                        "sServerMethod": "POST",
                        // Callback settings
                        "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {

                           var createdDate = new Date(parseInt(aData.CreatedDate.replace("/Date(", "").replace(")/", ""), 10));
                            var h = ("0" + createdDate.getHours()).slice(-2);
                            var m = ("0" + createdDate.getMinutes()).slice(-2);
                            var s = ("0" + createdDate.getSeconds()).slice(-2);

                            var dt_Created = $.datepicker.formatDate('dd/mm/yy', createdDate) + " " + h + ":" + m + ":" + s;
                            aData.CreatedDate = dt_Created;

                            var dropdownHtml = `
                        <div class="dropdown">
                            <button class="btn btn-outline-info dropdown-toggle" style="width: 100px;" type="button" id="dropdownMenuButton_${aData.Id}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Actions
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton_${aData.Id}">
                                <a class="dropdown-item" href="/registry/Zone/edit/${aData.Id}">Edit</a>
                                <a class="dropdown-item" href="/registry/Zone/details/${aData.Id}">View</a>
                            </div>
                        </div>`;



                            $('td:eq(6)', nRow).html(dt_Created);
                            $('td:eq(7)', nRow).html(dropdownHtml);

                            return nRow;
                        },
                        // Display settings
                        "aoColumns": [
                            { "mDataProp": "Description", "sTitle": "Zone", "sWidth": "10%" },
                            { "mDataProp": "DivisionDescription", "sTitle": "Division", "sWidth": "10%" },
                            { "mDataProp": "DivisionEmployerDescription", "sTitle": "Employer ", "sWidth": "10%" },
                            { "mDataProp": "Stations[0].Description", "sTitle": "Station", "sWidth": "10%" },
                            { "mDataProp": "Stations[0].AddressEmail", "sTitle": "Station Email ", "sWidth": "15%" },
                            { "mDataProp": "Stations[0].AddressMobileLine", "sTitle": "Station Mobile No:", "sWidth": "15%" },
                            { "mDataProp": "CreatedDate", "sTitle": "Created Date", "sWidth": "15%"},
                            { "mDataProp": "CreatedDate", "sTitle": "", "sWidth": "10%", "bSortable": false }],
                        "aaSorting": [[0, "desc"]]
                });
                });

                $(document).ajaxStart(function () {
                    $('.ibox').children('.ibox-content').toggleClass('sk-loading');
                });
                $(document).ajaxStop(function () {
                    $('.ibox').children('.ibox-content').toggleClass('sk-loading');
                });
        </script>*@
    <script>

         //ChartOfAccount typehead starts here
            $('.ChartOfAccountsLookup').typeahead({
                source: function (query, process) {
                    return $.getJSON(
                        '@Url.Action("GetChartOfAccountsAsync", "ChartOfAccount", new { Area = "Accounts" })',
                        { query: query },
                        function (ChartOfAccounts) {
                            var newChartOfAccountsData = [];
                            ChartOfAccountsMap = {};
                            $.each(ChartOfAccounts, function (i, ChartOfAccount) {
                                newChartOfAccountsData.push(ChartOfAccount.AccountName);
                                ChartOfAccountsMap[ChartOfAccount.AccountName] = ChartOfAccount;
                            });
                            process(newChartOfAccountsData); return;
                        });
                },
                matcher: function (item) {
                    if (item.toLowerCase().indexOf(this.query.trim().toLowerCase()) != -1) {
                        return true;
                    }
                },
                sorter: function (items) {
                    return items.sort();
                },
                highlighter: function (item) {
                    var regex = new RegExp('(' + this.query + ')', 'gi');
                    return item.replace(regex, "<strong>$1</strong>");
                },
                updater: function (item) {
                    var chartOfAccountId = "";
                    ChartOfAccountId = ChartOfAccountsMap[item].Id;
                    $('#Id').val(ChartOfAccountId);
                    //console.log(ChartOfAccountId)
                    return item;
                }
            });</script>

}
